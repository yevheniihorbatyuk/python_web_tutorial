# Module 8: –î–µ—Ç–∞–ª—å–Ω–∏–π –ü–ª–∞–Ω –ó–∞–Ω—è—Ç—Ç—è –∑ –ü–æ—è—Å–Ω–µ–Ω–Ω—è–º–∏
## Advanced Databases & Async Processing - –ü–æ–≤–Ω–∏–π –ü–æ—Å—ñ–±–Ω–∏–∫

**–¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å**: 3-4 –≥–æ–¥–∏–Ω–∏ | **–†—ñ–≤–µ–Ω—å**: Senior Engineer | **–§–æ—Ä–º–∞—Ç**: –ü—Ä–∞–∫—Ç–∏—á–Ω–∏–πË¨õÂ∫ß

---

## üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ó–∞–Ω—è—Ç—Ç—è

```
0. –†–æ–∑—ñ–≥—Ä—ñ–≤ (5 —Ö–≤)          ‚Üí –ö–æ–Ω—Ç–µ–∫—Å—Ç —Ç–∞ —Ü—ñ–ª—ñ
1. SQLAlchemy Advanced (70 —Ö–≤) ‚Üí ORM —Ç–∞ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è
2. MongoDB (50 —Ö–≤)           ‚Üí NoSQL —Ç–∞ –∞–≥—Ä–µ–≥–∞—Ü—ñ—ó
3. Caching (20 —Ö–≤)           ‚Üí –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å
4. RabbitMQ (40 —Ö–≤)          ‚Üí –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞ –æ–±—Ä–æ–±–∫–∞
5. Real-World Integration (20 —Ö–≤) ‚Üí –í—Å–µ —Ä–∞–∑–æ–º
6. Q&A / –ü—Ä–∞–∫—Ç–∏–∫–∞ (15 —Ö–≤)    ‚Üí –ü–∏—Ç–∞–Ω–Ω—è —Ç–∞ –¥–æ–º–∞—à–Ω—è —Ä–æ–±–æ—Ç–∞
```

---

# üéØ 0. –†–û–ó–Ü–ì–†–Ü–í (5 —Ö–≤–∏–ª–∏–Ω)

## –ú–µ—Ç–∞ –∑–∞–Ω—è—Ç—Ç—è

**–ü–∏—Ç–∞–Ω–Ω—è –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤**:
> "–£—è–≤—ñ—Ç—å, —â–æ —É –≤–∞—Å —î 1 –º–ª–Ω –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤. API –≤–∏–¥–∞—î 50 –∑–∞–ø–∏—Ç—ñ–≤/—Å–µ–∫. –Ø–∫ –≤–∏ –º–∞—Ç–∏–º–µ—Ç–µ —Å–ø—Ä–∞–≤—É –∑:"
> 1. –°—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–∏–º–∏ –¥–∞–Ω–Ω–∏–º–∏ (–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ, –∞–¥—Ä–µ—Å–∏, –∫—Ä–∞—ó–Ω–∏)?
> 2. –ù–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–∏–º–∏ –ø–æ–¥—ñ—è–º–∏ (–∫–ª—ñ–∫, –ø–æ–∫—É–ø–∫–∞, –ø–µ—Ä–µ–≥–ª—è–¥)?
> 3. –ü–æ–≤—ñ–ª—å–Ω–∏–º–∏ –æ–ø–µ—Ä–∞—Ü—ñ—è–º–∏ (—Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ–π)?

**–í—ñ–¥–ø–æ–≤—ñ–¥—å (—â–æ –º–∏ –≤–∏–≤—á–∏–º–æ)**:
- **PostgreSQL + SQLAlchemy** ‚Üí –°—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ, ACID, —Å–∫–ª–∞–¥–Ω—ñ –∑–∞–ø–∏—Ç–∏
- **MongoDB** ‚Üí –°–æ–±—ã—Ç–∏—è, –≥–Ω—É—á–∫–∞ —Å—Ö–µ–º–∞, –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è
- **Redis** ‚Üí –ö–µ—à, —Å–µ—Å—ñ—ó, —Ä–µ–∞–ª-—Ç–∞–π–º
- **RabbitMQ** ‚Üí –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞ –æ–±—Ä–æ–±–∫–∞, –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —Å–µ—Ä–≤—ñ—Å—ñ–≤
- **Data Science Engine** ‚Üí –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó, —Å–µ–≥–º–µ–Ω—Ç–∞—Ü—ñ—è, –ø—Ä–µ–¥–∏–∫—Ü—ñ—ó

**–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: –°—Ç—É–¥–µ–Ω—Ç–∏ —Ä–æ–∑—É–º—ñ—Ç–∏–º—É—Ç—å, –∫–æ–ª–∏ —ñ —è–∫ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∫–æ–∂–µ–Ω —Å–µ—Ä–≤—ñ—Å.

---

# üóÑÔ∏è 1. SQLALCHEMY ADVANCED (70 —Ö–≤–∏–ª–∏–Ω)

## 1.1 ORM vs SQL (10 —Ö–≤–∏–ª–∏–Ω)

### –¢–µ–æ—Ä—ñ—è

**Object-Relational Mapping (ORM)** ‚Äî —Ü–µ –∞–±—Å—Ç—Ä–∞–∫—Ü—ñ—è, —è–∫–∞:
- –ü–µ—Ä–µ—Ç–≤–æ—Ä—é—î —Ç–∞–±–ª–∏—Ü—ñ –ë–î –Ω–∞ Python –∫–ª–∞—Å–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≥–µ–Ω–µ—Ä—É—î SQL –∑–∞–ø–∏—Ç–∏
- –ó–∞–ø–æ–±—ñ–≥–∞—î SQL injection
- –°–ø—Ä–æ—â—É—î –º—ñ–≥—Ä–∞—Ü—ñ—ó

### –ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ ORM?
```
‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π SQLAlchemy –∫–æ–ª–∏:
  - –ü–æ—Ç—Ä–µ–±–Ω–∞ –≥–Ω—É—á–∫—ñ—Å—Ç—å (–¥–æ–¥–∞–≤–∞—Ç–∏ –ø–æ–ª—è)
  - –ü—Ä–∞—Ü—é—î—à –∑ —Ä—ñ–∑–Ω–∏–º–∏ –ë–î (Postgres, MySQL, SQLite)
  - –ö–æ–º–∞–Ω–¥–∞ —Ö–æ—á–µ —á–∏—Ç–∞–±–µ–ª—å–Ω–∏–π Python –∫–æ–¥ –∑–∞–º—ñ—Å—Ç—å SQL
  - –Ñ —Å–∫–ª–∞–¥–Ω—ñ relationship'–∏

‚ùå –ò—Å–ø–æ–ª—å–∑—É–π Raw SQL –∫–æ–ª–∏:
  - –í–∏—Å–æ–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –∫—Ä–∏—Ç–∏—á–Ω–∞ (–ø–æ–≤—ñ–ª—å–Ω–µ ORM)
  - –°–ø–µ—Ü–∏—Ñ—ñ—á–Ω—ñ SQL —Ñ—É–Ω–∫—Ü—ñ—ó (window functions, JSON –æ–ø–µ—Ä–∞—Ü—ñ—ó)
  - –û–¥–∏–Ω –º–∞—Å–∏–≤–Ω–∏–π –∑–∞–ø–∏—Ç –∫—Ä–∞—â–µ –Ω—ñ–∂ N –º–∞–ª–∏—Ö
```

### –ü—Ä–∞–∫—Ç–∏—á–Ω–∏–π –ø—Ä–∏–∫–ª–∞–¥

```python
# ‚ùå –ü–æ–≥–∞–Ω–æ: –ö–æ–∂–µ–Ω –∑–∞–ø–∏—Ç –¥–æ –ë–î (N+1 –ø—Ä–æ–±–ª–µ–º–∞)
users = User.query.all()
for user in users:
    print(user.address.city.name)  # –û–∫—Ä–µ–º–∏–π –∑–∞–ø–∏—Ç –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ!

# ‚úÖ –î–æ–±—Ä–µ: –û–¥–∏–Ω –∑–∞–ø–∏—Ç –∑ eager loading
from sqlalchemy.orm import joinedload
users = session.query(User).options(
    joinedload(User.address).joinedload(Address.city)
).all()
for user in users:
    print(user.address.city.name)  # –ù–µ–º–∞ –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤!
```

---

## 1.2 –ú–æ–¥–µ–ª—ñ –î–∞–Ω–∏—Ö (20 —Ö–≤–∏–ª–∏–Ω)

### –Ü—î—Ä–∞—Ä—Ö—ñ—è –î–∞–Ω–∏—Ö

```
Country (–ö—Ä–∞—ó–Ω–∞)
  ‚îî‚îÄ City (–ú—ñ—Å—Ç–æ)
      ‚îî‚îÄ Address (–ê–¥—Ä–µ—Å–∞)
          ‚îî‚îÄ User (–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á)
```

### –ß–æ–º—É —Ç–∞–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞?

**–°—Ü–µ–Ω–∞—Ä—ñ–π**: –ê–Ω–∞–ª—ñ–∑ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –∑–∞ –∫—Ä–∞—ó–Ω–∞–º–∏ —Ç–∞ –º—ñ—Å—Ç–∞–º–∏.

```
–ó–∞–ø–∏—Ç 1: "–°–∫—ñ–ª—å–∫–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —É –£–∫—Ä–∞—ó–Ω—ñ?"
–ó–∞–ø–∏—Ç 2: "–Ø–∫–∞ –Ω–∞–π–±—ñ–ª—å—à–∞ –∞–¥—Ä–µ—Å–∞ —É –ö–∏—ó–≤—ñ?"
–ó–∞–ø–∏—Ç 3: "–†–µ–π—Ç–∏–Ω–≥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –ø–æ –∫—Ä–∞—ó–Ω–∞–º"
```

### –°—Ö–µ–º–∞ –ë–î (–∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–æ)

```python
# –¢–ê–ë–õ–ò–¶–Ø countries
id  | name      | code | population | gdp_per_capita
1   | Ukraine   | UA   | 40000000   | 4200
2   | Poland    | PL   | 38000000   | 15600
3   | Germany   | DE   | 83000000   | 46200

# –¢–ê–ë–õ–ò–¶–Ø cities
id | name  | country_id | region
1  | Kyiv  | 1          | Kyiv
2  | Kharkiv | 1        | Kharkiv
3  | Warsaw | 2         | Mazovia

# –¢–ê–ë–õ–ò–¶–Ø addresses
id | street              | city_id | postal_code
1  | Khreschatyk St, 1   | 1       | 01001
2  | Sumska St, 10       | 2       | 61001

# –¢–ê–ë–õ–ò–¶–Ø users
id | email             | username        | address_id | profile_score | is_verified
1  | ivan@example.com  | ivan_data       | 1          | 85.5          | False
2  | maria@example.com | maria_ml        | 1          | 92.0          | False
```

### SQLAlchemy –ú–æ–¥–µ–ª—ñ

```python
# ================================================
# –§–∞–π–ª: 01_sqlalchemy_advanced.py (–í–ò–í–Ü–î–î–ï–†–ü–ê–ö)
# ================================================

from sqlalchemy import create_engine, Column, Integer, String, Float, ForeignKey, Index
from sqlalchemy.orm import declarative_base, relationship, sessionmaker

Base = declarative_base()

# 1. –ú–û–î–ï–õ–¨ –ö–†–ê–á–ù–ò
class Country(Base):
    """
    –ü—Ä–µ–¥—Å—Ç–∞–≤–ª—è—î –∫—Ä–∞—ó–Ω—É —É –ë–î.

    –ê—Ç—Ä–∏–±—É—Ç–∏:
      id: Primary key (—É–Ω—ñ–∫–∞–ª—å–Ω–∏–π —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä)
      name: –ù–∞–∑–≤–∞ –∫—Ä–∞—ó–Ω–∏ (UNIQUE - –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ 2 –æ–¥–Ω–∞–∫–æ–≤—ñ)
      code: ISO –∫–æ–¥ (UA, PL, DE)
      population: –ù–∞—Å–µ–ª–µ–Ω–Ω—è
      gdp_per_capita: –í–í–ü –Ω–∞ –¥—É—à—É –Ω–∞—Å–µ–ª–µ–Ω–Ω—è
      cities: Relationship –¥–æ –≤—Å—ñ—Ö –º—ñ—Å—Ç —Ü—ñ—î—ó –∫—Ä–∞—ó–Ω–∏

    Relationship –ª–æ–≥—ñ–∫–∞:
      - 1 Country ‚Üí Many Cities (–æ–¥–∏–Ω –¥–æ –±–∞–≥–∞—Ç—å–æ—Ö)
      - cascade="all, delete-orphan" –æ–∑–Ω–∞—á–∞—î: —è–∫—â–æ –≤–∏–¥–∞–ª–∏—Ç–∏ –∫—Ä–∞—ó–Ω—É,
        —Ç–æ –≤—Å—ñ –¥–æ—á—ñ—Ä–Ω—ñ –º—ñ—Å—Ç–∞ —Ç–µ–∂ –≤–∏–¥–∞–ª—è—é—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
    """
    __tablename__ = "countries"

    id = Column(Integer, primary_key=True)
    name = Column(String(100), unique=True, nullable=False)  # –£–Ω—ñ–∫–∞–ª—å–Ω–∞ –Ω–∞–∑–≤–∞
    code = Column(String(3), unique=True, nullable=False)    # UA, PL, DE
    population = Column(Integer)
    gdp_per_capita = Column(Float)

    # –ó–≤–æ—Ä–æ—Ç–Ω–∏–π –∑–≤'—è–∑–æ–∫: –≤—ñ–¥–∫—Ä–∏–≤–∞—î –¥–æ—Å—Ç—É–ø –¥–æ –≤—Å—ñ—Ö –º—ñ—Å—Ç –∫—Ä–∞—ó–Ω–∏
    cities = relationship("City", cascade="all, delete-orphan", back_populates="country")

    def __repr__(self):
        return f"<Country(name='{self.name}', code='{self.code}')>"

# 2. –ú–û–î–ï–õ–¨ –ú–Ü–°–¢–ê
class City(Base):
    """
    –ü—Ä–µ–¥—Å—Ç–∞–≤–ª—è—î –º—ñ—Å—Ç–æ —É –ë–î.

    ForeignKey:
      country_id: –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –±–∞—Ç—å–∫—ñ–≤—Å—å–∫—É –∫—Ä–∞—ó–Ω—É
      ForeignKey("countries.id") –æ–∑–Ω–∞—á–∞—î: —Ü–µ –∑–Ω–∞—á–µ–Ω–Ω—è –º–∞—î —ñ—Å–Ω—É–≤–∞—Ç–∏ –≤ —Ç–∞–±–ª–∏—Ü—ñ countries
    """
    __tablename__ = "cities"

    id = Column(Integer, primary_key=True)
    name = Column(String(100), nullable=False)
    region = Column(String(100))  # –û–±–ª–∞—Å—Ç—å, —Ä–µ–≥—ñ–æ–Ω
    country_id = Column(Integer, ForeignKey("countries.id"), nullable=False)

    # –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –±–∞—Ç—å–∫—ñ–≤—Å—å–∫—É –∫—Ä–∞—ó–Ω—É
    country = relationship("Country", back_populates="cities")
    # –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –≤—Å—ñ –∞–¥—Ä–µ—Å–∏ —É —Ü—å–æ–º—É –º—ñ—Å—Ç—ñ
    addresses = relationship("Address", cascade="all, delete-orphan", back_populates="city")

    def __repr__(self):
        return f"<City(name='{self.name}')>"

# 3. –ú–û–î–ï–õ–¨ –ê–î–†–ï–°–ò
class Address(Base):
    """
    –ü—Ä–µ–¥—Å—Ç–∞–≤–ª—è—î –∞–¥—Ä–µ—Å—É —É –ë–î.

    –Ü–Ω–¥–µ–∫—Å–∏:
      Index() –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è —à–≤–∏–¥–∫–∏—Ö –ø–æ—à—É–∫—ñ–≤.
      –ë–µ–∑ —ñ–Ω–¥–µ–∫—Å—É –∑–∞–ø–∏—Ç "–∑–Ω–∞–π—Ç–∏ –≤—Å—ñ –∞–¥—Ä–µ—Å–∏ —É –º—ñ—Å—Ç—ñ –•" –ø–æ–≤–∏–Ω–µ–Ω —Å–∫–∞–Ω–∏—Ç–∏ –≤—Å—ñ —Ä—è–¥–∫–∏.
      –ó —ñ–Ω–¥–µ–∫—Å–æ–º ‚Äî –∑–Ω–∞—Ö–æ–¥–∏—Ç—å –∑–∞ O(log n) –∑–∞–º—ñ—Å—Ç—å O(n).
    """
    __tablename__ = "addresses"

    id = Column(Integer, primary_key=True)
    street = Column(String(200), nullable=False)
    postal_code = Column(String(10))
    city_id = Column(Integer, ForeignKey("cities.id"), nullable=False)

    # –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –º—ñ—Å—Ç–æ
    city = relationship("City", back_populates="addresses")
    # –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –≤—Å—ñ—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –Ω–∞ —Ü—ñ–π –∞–¥—Ä–µ—Å—ñ
    users = relationship("User", back_populates="address")

    # –Ü–Ω–¥–µ–∫—Å –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –ø–æ—à—É–∫—É –ø–æ –º—ñ—Å—Ç—É
    __table_args__ = (
        Index("idx_address_city_id", "city_id"),
    )

    def __repr__(self):
        return f"<Address(street='{self.street}')>"

# 4. –ú–û–î–ï–õ–¨ –ö–û–†–ò–°–¢–£–í–ê–ß–ê
class User(Base):
    """
    –ü—Ä–µ–¥—Å—Ç–∞–≤–ª—è—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —É –ë–î.

    Profile Score (–†–µ–π—Ç–∏–Ω–≥ –ø—Ä–æ—Ñ—ñ–ª—é):
      - 0-50: –ù–æ–≤–∏—á–æ–∫, –º–∞–ª–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
      - 50-80: –ê–∫—Ç–∏–≤–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á
      - 80-100: –ï–∫—Å–ø–µ—Ä—Ç, –¥—É–∂–µ –∞–∫—Ç–∏–≤–Ω–∏–π
    """
    __tablename__ = "users"

    id = Column(Integer, primary_key=True)
    email = Column(String(100), unique=True, nullable=False)
    username = Column(String(50), unique=True, nullable=False)
    address_id = Column(Integer, ForeignKey("addresses.id"))
    profile_score = Column(Float, default=0.0)
    is_verified = Column(Integer, default=0)  # 1 = True, 0 = False

    # –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –∞–¥—Ä–µ—Å—É
    address = relationship("Address", back_populates="users")

    def __repr__(self):
        return f"<User(username='{self.username}', score={self.profile_score})>"
```

### –ü–æ—á–µ–º—É —Ç–∞–∫–æ—ó —ñ—î—Ä–∞—Ä—Ö—ñ—ó?

1. **–ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö** ‚Äî —É–Ω–∏–∫–∞—î–º–æ –¥—É–±–ª—é–≤–∞–Ω–Ω—è (—ñ–º'—è –∫—Ä–∞—ó–Ω–∏ –Ω–µ –ø–æ–≤—Ç–æ—Ä—é—î—Ç—å—Å—è –¥–ª—è –∫–æ–∂–Ω–æ—ó –∞–¥—Ä–µ—Å–∏)
2. **ACID –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ** ‚Äî —è–∫—â–æ –∑–º—ñ–Ω–∏—Ç–∏ –Ω–∞–∑–≤—É –º—ñ—Å—Ç–∞, —Ü–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–ø–ª–∏–≤–∞—î –Ω–∞ –≤—Å—ñ—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —É —Ü—å–æ–º—É –º—ñ—Å—Ç—ñ
3. **–ì–Ω—É—á–∫—ñ—Å—Ç—å –∑–∞–ø–∏—Ç—ñ–≤** ‚Äî –º–æ–∂–µ–º–æ –∞–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –Ω–∞ –±—É–¥—å-—è–∫–æ–º—É —Ä—ñ–≤–Ω—ñ (–∫—Ä–∞—ó–Ω–∞, –º—ñ—Å—Ç–æ, –∞–¥—Ä–µ—Å–∞)

---

## 1.3 CRUD –æ–ø–µ—Ä–∞—Ü—ñ—ó —Ç–∞ Session (15 —Ö–≤–∏–ª–∏–Ω)

### –©–æ —Ç–∞–∫–µ Session?

**Session** ‚Äî —Ü–µ "—Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è" –∑ –ë–î. –í–æ–Ω–∞:
- –û—Ç—Ä–∏–º—É—î –¥–∞–Ω—ñ
- –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º—É—î —ó—Ö
- –ó–±–µ—Ä—ñ–≥–∞—î –∑–º—ñ–Ω–∏ –∞—Ç–æ–º–∞—Ä–Ω–æ (–∞–±–æ –≤—ñ–¥–∫–æ—á—É—î –≤—Å–µ)

```python
# ================================================
# –ü–†–ê–ö–¢–ò–ß–ù–ê –û–ü–ï–†–ê–¶–Ü–Ø: CRUD
# ================================================

# CREATE (–î–æ–¥–∞–≤–∞–Ω–Ω—è)
session = SessionLocal()

# 1. –î–æ–¥–∞—Ç–∏ –∫—Ä–∞—ó–Ω—É
ukraine = Country(name="Ukraine", code="UA", population=40000000, gdp_per_capita=4200)
session.add(ukraine)
session.commit()  # –ó–±–µ—Ä–µ–≥—Ç–∏ —É –ë–î
print(f"‚úì –î–æ–¥–∞–Ω–∞ –∫—Ä–∞—ó–Ω–∞: {ukraine}")

# 2. –î–æ–¥–∞—Ç–∏ –º—ñ—Å—Ç–æ –¥–æ –∫—Ä–∞—ó–Ω–∏
kyiv = City(name="Kyiv", region="Kyiv", country=ukraine)
session.add(kyiv)
session.commit()
print(f"‚úì –î–æ–¥–∞–Ω–µ –º—ñ—Å—Ç–æ: {kyiv}")

# 3. –î–æ–¥–∞—Ç–∏ –∞–¥—Ä–µ—Å—É –¥–æ –º—ñ—Å—Ç–∞
address = Address(street="Khreschatyk St, 1", city=kyiv)
session.add(address)
session.commit()
print(f"‚úì –î–æ–¥–∞–Ω–∞ –∞–¥—Ä–µ—Å–∞: {address}")

# 4. –î–æ–¥–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –¥–æ –∞–¥—Ä–µ—Å–∏
user = User(
    email="ivan@example.com",
    username="ivan_data",
    address=address,
    profile_score=85.5
)
session.add(user)
session.commit()
print(f"‚úì –î–æ–¥–∞–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á: {user}")

# READ (–ß–∏—Ç–∞–Ω–Ω—è)
user = session.query(User).filter(User.username == "ivan_data").first()
print(f"–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á: {user.username}, –º—ñ—Å—Ç–æ: {user.address.city.name}")

# UPDATE (–û–Ω–æ–≤–ª–µ–Ω–Ω—è)
user.profile_score = 90.0
session.commit()
print(f"–û–Ω–æ–≤–ª–µ–Ω–æ —Ä–µ–π—Ç–∏–Ω–≥ –Ω–∞: {user.profile_score}")

# DELETE (–í–∏–¥–∞–ª–µ–Ω–Ω—è)
session.delete(user)
session.commit()
print(f"‚úì –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–∏–¥–∞–ª–µ–Ω–∏–π")

session.close()
```

### –ß–æ–º—É Session –≤–∞–∂–ª–∏–≤–∞?

```python
# ‚ùå –ü–û–ì–ê–ù–û: –ú–Ω–æ–∂–∏–Ω–Ω—ñ connection'–∏, –Ω–µ–º–∞—î —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π
connection = create_engine("postgresql://...").connect()
connection.execute("INSERT INTO users VALUES (...)")
connection.execute("INSERT INTO addresses VALUES (...)")
connection.close()
# –Ø–∫—â–æ —Å—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞ –º—ñ–∂ –¥–≤–æ–º–∞ INSERT'–∞–º–∏,
# –∞–¥—Ä–µ—Å–∞ –±—É–¥–µ —É –ë–î –∞–ª–µ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–µ–º–∞—î!

# ‚úÖ –î–û–ë–†–ï: –û–¥–Ω–∞ session, atomic —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è
session = SessionLocal()
try:
    session.add(address)
    session.add(user)
    session.commit()  # –ê–±–æ –æ–±–∏–¥–≤–∞, –∞–±–æ –Ω—ñ—á–æ–≥–æ
except Exception:
    session.rollback()  # –°–∫–∞—Å—É–≤–∞—Ç–∏ –≤—Å—ñ –∑–º—ñ–Ω–∏
finally:
    session.close()
```

---

## 1.4 –ó–∞–ø–∏—Ç–∏ —Ç–∞ –ê–≥—Ä–µ–≥–∞—Ü—ñ—ó (15 —Ö–≤–∏–ª–∏–Ω)

### –ó–∞–ø–∏—Ç 1: –£—Å—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –∑ –£–∫—Ä–∞—ó–Ω–∏

```python
# ‚ùå –ü–æ–≥–∞–Ω–æ (N+1 –ø—Ä–æ–±–ª–µ–º–∞):
users = session.query(User).all()  # –ó–∞–ø–∏—Ç 1
for user in users:
    if user.address.city.country.name == "Ukraine":  # –ó–∞–ø–∏—Ç–∏ 2, 3, 4... –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ!
        print(user.username)

# ‚úÖ –î–æ–±—Ä–µ (Eager Loading):
from sqlalchemy.orm import joinedload

users = session.query(User).options(
    joinedload(User.address)              # –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∞–¥—Ä–µ—Å–∏
    .joinedload(Address.city)             # –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –º—ñ—Å—Ç–∞
    .joinedload(City.country)             # –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∫—Ä–∞—ó–Ω–∏
).filter(
    City.country.has(Country.name == "Ukraine")  # –§—ñ–ª—å—Ç—Ä
).all()

# –¢–µ–ø–µ—Ä —É—Å–µ —É –æ–¥–Ω–æ–º—É –∑–∞–ø–∏—Ç—ñ!
for user in users:
    print(user.username)
```

### –ó–∞–ø–∏—Ç 2: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫—Ä–∞—ó–Ω–∞—Ö

```python
from sqlalchemy import func

# –°–∫—ñ–ª—å–∫–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —É –∫–æ–∂–Ω—ñ–π –∫—Ä–∞—ó–Ω—ñ?
stats = session.query(
    Country.name,                              # –ù–∞–∑–≤–∞ –∫—Ä–∞—ó–Ω–∏
    func.count(User.id).label("user_count"),   # –ö—ñ–ª—å–∫—ñ—Å—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
    func.avg(User.profile_score).label("avg_score")  # –°–µ—Ä–µ–¥–Ω—ñ–π —Ä–µ–π—Ç–∏–Ω–≥
).join(
    City                                       # –ü—Ä–∏—î–¥–Ω–∞—Ç–∏ —Ç–∞–±–ª–∏—Ü—é –º—ñ—Å—Ç
).join(
    Address                                    # –ü—Ä–∏—î–¥–Ω–∞—Ç–∏ –∞–¥—Ä–µ—Å–∏
).join(
    User                                       # –ü—Ä–∏—î–¥–Ω–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
).group_by(
    Country.name                               # –ì—Ä—É–ø—É–≤–∞—Ç–∏ –∑–∞ –Ω–∞–∑–≤–∞–Ω–Ω—è–º –∫—Ä–∞—ó–Ω–∏
).order_by(
    func.count(User.id).desc()                 # –°–æ—Ä—Ç—É–≤–∞—Ç–∏ –∑–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—é (—Å–ø–∞–¥–∞–Ω–Ω—è)
).all()

for country, count, avg_score in stats:
    print(f"{country}: {count} –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, avg score: {avg_score:.2f}")
```

### –ó–∞–ø–∏—Ç 3: –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –∑ –ö–∏—ó–≤–∞ –∑ —Ä–µ–π—Ç–∏–Ω–≥–æ–º > 80

```python
kyiv_experts = session.query(User).filter(
    User.profile_score > 80
).join(
    Address
).join(
    City
).filter(
    City.name == "Kyiv"
).order_by(
    User.profile_score.desc()
).all()

for user in kyiv_experts:
    print(f"‚úì {user.username}: {user.profile_score}")
```

---

## 1.5 –ú—ñ–≥—Ä–∞—Ü—ñ—ó —Ç–∞ Deployment (10 —Ö–≤–∏–ª–∏–Ω)

### –ß–æ–º—É –Ω–∞–º –ø–æ—Ç—Ä—ñ–±–Ω—ñ –º—ñ–≥—Ä–∞—Ü—ñ—ó?

–£—è–≤—ñ—Ç—å, —â–æ —É –ø—Ä–æ–¥–∞–∫—à–µ–Ω—ñ –≤–∂–µ 1000 –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤. –Ø–∫ –¥–æ–¥–∞—Ç–∏ –Ω–æ–≤–µ –ø–æ–ª–µ?

```python
# –í–µ—Ä—Å—ñ—è 1 (—Å—Ç–∞—Ä–∏–π –∫–æ–¥)
class User(Base):
    __tablename__ = "users"
    id = Column(Integer, primary_key=True)
    username = Column(String(50))

# –í–µ—Ä—Å—ñ—è 2 (–Ω–æ–≤–∏–π –∫–æ–¥ ‚Äî –¥–æ–¥–∞—î–º–æ –ø–æ–ª–µ email)
class User(Base):
    __tablename__ = "users"
    id = Column(Integer, primary_key=True)
    username = Column(String(50))
    email = Column(String(100))  # ‚Üê –ù–æ–≤–µ –ø–æ–ª–µ!

# ‚ùå –Ø–∫—â–æ –ø—Ä–æ—Å—Ç–æ –∫–∏–Ω—É—Ç–∏ Base.metadata.create_all(),
# —Ç–æ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É —Ä–æ–∑–ª–∞–º–∞—î—Ç—å—Å—è —á–µ—Ä–µ–∑ –Ω–µ—Å—É–º—ñ—Å–Ω—ñ—Å—Ç—å

# ‚úÖ –ó–∞–º—ñ—Å—Ç—å —Ü—å–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ Alembic (SQL –º—ñ–≥—Ä–∞—Ü—ñ—ó):
# alembic revision --autogenerate -m "add email to users"
# alembic upgrade head
```

### –°—Ç—Ä–∞—Ç–µ–≥—ñ—è —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è

```
1. –†–æ–∑—Ä–æ–±–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ (SQLite)
2. –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –Ω–∞ –∫–æ–ø—ñ—ó prodduction (Postgres)
3. Alembic –º—ñ–≥—Ä–∞—Ü—ñ—è –Ω–∞ staging
4. Alembic –º—ñ–≥—Ä–∞—Ü—ñ—è –Ω–∞ production (–∑ backup!)
5. –°–∫–∞—Ç—É–≤–∞–Ω–Ω—è (rollback) –µ—Å–ª–∏ –ø–æ–º–∏–ª–∫–∞
```

---

# üóÇÔ∏è 2. MONGODB ADVANCED (50 —Ö–≤–∏–ª–∏–Ω)

## 2.1 –í—Å—Ç—É–ø –¥–æ MongoDB (10 —Ö–≤–∏–ª–∏–Ω)

### –°—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–∞ vs –ì–Ω—É—á–∫–∞ –°—Ö–µ–º–∞

```
PostgreSQL (Rigid):
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ user                            ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ id (int)    | username (string) ‚îÇ
‚îÇ 1           | ivan              ‚îÇ
‚îÇ 2           | maria             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚úì –§—ñ–∫—Å–æ–≤–∞–Ω–∞ —Å—Ö–µ–º–∞
‚úó –î–æ–¥–∞—Ç–∏ –Ω–æ–≤–µ –ø–æ–ª–µ ‚Äî –ø–æ—Ç—Ä–µ–±–Ω–∞ –º—ñ–≥—Ä–∞—Ü—ñ—è

MongoDB (Flexible):
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ users collection                       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ { _id: 1, username: "ivan" }           ‚îÇ
‚îÇ { _id: 2, username: "maria",           ‚îÇ
‚îÇ   email: "maria@ex.com" }              ‚îÇ ‚Üê –†—ñ–∑–Ω—ñ –ø–æ–ª—è!
‚îÇ { _id: 3, username: "john",            ‚îÇ
‚îÇ   email: "john@ex.com",                ‚îÇ
‚îÇ   subscriptions: ["pro"] }             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚úì –ì–Ω—É—á–∫–∞ —Å—Ö–µ–º–∞
‚úì –ö–æ–∂–µ–Ω –¥–æ–∫—É–º–µ–Ω—Ç –º–æ–∂–µ –º–∞—Ç–∏ —Ä—ñ–∑–Ω—ñ –ø–æ–ª—è
‚úó –ü–æ—Ç—Ä–µ–±–Ω–∞ –±—ñ–ª—å—à–µ —É–≤–∞–∂–Ω–æ—Å—Ç—ñ –ø—Ä–∏ –∑–∞–ø–∏—Ç–∞—Ö
```

### –í–∏–±—ñ—Ä –º—ñ–∂ Postgres —Ç–∞ MongoDB

```
–ò—Å–ø–æ–ª—å–∑—É–π PostgreSQL –∫–æ–ª–∏:
‚úì –î–∞–Ω—ñ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω—ñ (–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ, –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è, –ø–ª–∞—Ç–µ–∂—ñ)
‚úì –ù—É–∂–Ω–∏ ACID —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó (–≥—Ä–æ—à–æ–≤—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó)
‚úì –ë–∞–≥–∞—Ç–æ JOIN'—ñ–≤ (–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á + –∞–¥—Ä–µ—Å–∞ + –∫—Ä–∞—ó–Ω–∞)
‚úì –î–∞–Ω—ñ –Ω–µ –∑–º—ñ–Ω—é—é—Ç—å—Å—è —á–∞—Å—Ç–æ

–ò—Å–ø–æ–ª—å–∑—É–π MongoDB –∫–æ–ª–∏:
‚úì –î–∞–Ω—ñ –≥–Ω—É—á–∫—ñ (–µ–≤–µ–Ω—Ç–∏, –ª–æ–≥–∏, –ø—Ä–æ—Ñ—ñ–ª—ñ)
‚úì –î–æ–∫—É–º–µ–Ω—Ç-–æ—Ä—ñ—î–Ω—Ç–æ–≤–∞–Ω–æ (–æ–¥–∏–Ω –¥–æ–∫—É–º–µ–Ω—Ç = –æ–¥–∏–Ω –æ–±'—î–∫—Ç)
‚úì –ú–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è (–≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–µ sharding)
‚úì –ì–∞—Ä—è—á—ñ –¥–∞–Ω—ñ –∑ —á–∞—Å—Ç–∏–º–∏ –∑–º—ñ–Ω–∞–º–∏
‚úì –ì–Ω—ñ–∑–¥—è–≤–∞—Ç—ñ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ (–¥–æ–∫—É–º–µ–Ω—Ç —É –¥–æ–∫—É–º–µ–Ω—Ç—ñ)
```

---

## 2.2 PyMongo CRUD —Ç–∞ –ê–≥—Ä–µ–≥–∞—Ü—ñ—ó (15 —Ö–≤–∏–ª–∏–Ω)

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞ evento

```javascript
// MongoDB JSON —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (—É –¥–æ–∫—É–º–µ–Ω—Ç—ñ events)
{
  _id: ObjectId("507f1f77bcf86cd799439011"),
  user_id: 123,
  event_type: "user_purchase",        // –¢–∏–ø —Å–æ–±—ã—Ç–∏—è
  timestamp: ISODate("2024-01-15T10:30:00Z"),
  metadata: {
    product_id: "PROD-001",
    price: 99.99,
    category: "electronics"
  },
  geo: {
    country: "Ukraine",
    city: "Kyiv",
    coordinates: [50.4501, 30.5234]   // [—à–∏—Ä–æ—Ç–∞, –¥–æ–≤–≥–æ—Ç–∞]
  },
  session_info: {
    device: "mobile",
    os: "iOS",
    app_version: "2.1.0"
  }
}
```

### –í—Å—Ç–∞–≤–∫–∞ –î–æ–∫—É–º–µ–Ω—Ç—ñ–≤

```python
# ================================================
# –§–∞–π–ª: 02_mongodb_advanced.py (–í–ò–í–Ü–î–ü–ê–ö)
# ================================================

from pymongo import MongoClient

# –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ MongoDB Atlas
client = MongoClient("mongodb+srv://username:password@cluster.mongodb.net/")
db = client["data_science_db"]
events_collection = db["events"]

# 1. –í—Å—Ç–∞–≤–∏—Ç–∏ –æ–¥–∏–Ω –¥–æ–∫—É–º–µ–Ω—Ç
event_data = {
    "user_id": 123,
    "event_type": "user_purchase",
    "timestamp": datetime.utcnow(),
    "metadata": {
        "product_id": "PROD-001",
        "price": 99.99,
        "category": "electronics"
    },
    "geo": {
        "country": "Ukraine",
        "city": "Kyiv",
        "coordinates": [50.4501, 30.5234]
    }
}

result = events_collection.insert_one(event_data)
print(f"–î–æ–∫—É–º–µ–Ω—Ç –≤—Å—Ç–∞–≤–ª–µ–Ω–∏–π: {result.inserted_id}")

# 2. –í—Å—Ç–∞–≤–∏—Ç–∏ –±–∞–≥–∞—Ç–æ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤ (BULK)
events_list = [
    {"user_id": 1, "event_type": "click", "timestamp": datetime.utcnow()},
    {"user_id": 2, "event_type": "purchase", "timestamp": datetime.utcnow()},
    {"user_id": 3, "event_type": "view", "timestamp": datetime.utcnow()},
]

result = events_collection.insert_many(events_list)
print(f"–í—Å—Ç–∞–≤–ª–µ–Ω–æ {len(result.inserted_ids)} –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤")

# 3. –ß–∏—Ç–∞–Ω–Ω—è –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤
# –ó–Ω–∞–π—Ç–∏ –≤—Å—ñ —Å–æ–±—ã—Ç–∏—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ 123
user_events = list(events_collection.find({"user_id": 123}))
print(f"–°–æ–±—ã—Ç–∏—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞: {user_events}")

# 4. –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è —Ç–∞ —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è
recent_purchases = list(
    events_collection.find({
        "event_type": "user_purchase"
    }).sort("timestamp", -1).limit(10)  # –ù–æ–≤—ñ—à—ñ —Å–ø–æ—á–∞—Ç–∫—É, –º–∞–∫—Å–∏–º—É–º 10
)
print(f"–û—Å—Ç–∞–Ω–Ω—ñ 10 –ø–æ–∫—É–ø–æ–∫: {recent_purchases}")

# 5. –û–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–æ–∫—É–º–µ–Ω—Ç–∞
events_collection.update_one(
    {"_id": ObjectId("...")},  # –Ø–∫–∏–π –¥–æ–∫—É–º–µ–Ω—Ç –æ–Ω–æ–≤–∏—Ç–∏
    {"$set": {"metadata.price": 149.99}}  # –©–æ –∑–º—ñ–Ω–∏—Ç–∏
)

# 6. –í–∏–¥–∞–ª–µ–Ω–Ω—è
events_collection.delete_one({"user_id": 999})
```

### –ê–≥—Ä–µ–≥–∞—Ü—ñ–π–Ω—ñ –ö–æ–Ω–≤–µ—î—Ä–∏ (Pipeline)

–ê–≥—Ä–µ–≥–∞—Ü—ñ—è ‚Äî —Ü–µ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—å —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü—ñ–π –¥–∞–Ω–∏—Ö.

```python
# –ó–ê–î–ê–ß–ê: "–ü–æ—Ä–∞—Ö—É–≤–∞—Ç–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ–∫—É–ø–æ–∫ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è—Ö"

# SQL –≤–µ—Ä—Å—ñ—è:
# SELECT category, COUNT(*) as count, SUM(price) as total_revenue
# FROM events WHERE event_type = 'user_purchase'
# GROUP BY category ORDER BY total_revenue DESC

# MongoDB –≤–µ—Ä—Å—ñ—è:
pipeline = [
    # –ï—Ç–∞–ø 1: –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è (ÈÅ∏Êìá—Ç—ñ–ª—å–∫–∏ –ø–æ–∫—É–ø–∫–∏)
    {
        "$match": {
            "event_type": "user_purchase"
        }
    },
    # –ï—Ç–∞–ø 2: –ì—Ä—É–ø—É–≤–∞–Ω–Ω—è —Ç–∞ –∞–≥—Ä–µ–≥–∞—Ü—ñ—è
    {
        "$group": {
            "_id": "$metadata.category",           # –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –ø–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó
            "count": {"$sum": 1},                  # –ö—ñ–ª—å–∫—ñ—Å—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤
            "total_revenue": {"$sum": "$metadata.price"},  # –°—É–º–∞ —Ü—ñ–Ω
            "avg_price": {"$avg": "$metadata.price"}       # –°–µ—Ä–µ–¥–Ω—è —Ü—ñ–Ω–∞
        }
    },
    # –ï—Ç–∞–ø 3: –°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è
    {
        "$sort": {"total_revenue": -1}  # –°–ø–∞–¥–∞—é—á–∏–π –ø–æ—Ä—è–¥–æ–∫ (–±—ñ–ª—å—à–µ —Å–ø–æ—á–∞—Ç–∫—É)
    }
]

result = list(events_collection.aggregate(pipeline))

for item in result:
    print(f"{item['_id']}: {item['count']} –ø–æ–∫—É–ø–æ–∫, ${item['total_revenue']:.2f}")
```

### –°–∫–ª–∞–¥–Ω—ñ—à–∏–π –ø—Ä–∏–∫–ª–∞–¥: User Activity

```python
# –ó–ê–î–ê–ß–ê: "–ó–Ω–∞–π—Ç–∏ —Ç–æ–ø-10 –Ω–∞–π–±—ñ–ª—å—à –∞–∫—Ç–∏–≤–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –∑–∞ –æ—Å—Ç–∞–Ω–Ω—ñ–π –º—ñ—Å—è—Ü—å"

pipeline = [
    # 1. –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –ø–æ –¥–∞—Ç—ñ
    {
        "$match": {
            "timestamp": {
                "$gte": datetime.utcnow() - timedelta(days=30)
            }
        }
    },
    # 2. –ì—Ä—É–ø—É–≤–∞–Ω–Ω—è –ø–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É
    {
        "$group": {
            "_id": "$user_id",
            "event_count": {"$sum": 1},              # –°–∫—ñ–ª—å–∫–∏ –ø–æ–¥—ñ–π
            "event_types": {"$push": "$event_type"}, # –°–ø–∏—Å–æ–∫ –≤—Å—ñ—Ö —Ç–∏–ø—ñ–≤
            "last_event": {"$max": "$timestamp"},    # –ö–æ–ª–∏ –æ—Å—Ç–∞–Ω–Ω—è –ø–æ–¥—ñ—è
            "total_spent": {"$sum": {"$cond": [
                {"$eq": ["$event_type", "user_purchase"]},
                "$metadata.price",  # –Ø–∫—â–æ –ø–æ–∫—É–ø–∫–∞, —Ç–æ —Ü—ñ–Ω–∞
                0                   # –Ü–Ω–∞–∫—à–µ 0
            ]}}
        }
    },
    # 3. –°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è –ø–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
    {
        "$sort": {"event_count": -1}
    },
    # 4. –û–±–º–µ–∂–µ–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤
    {
        "$limit": 10
    }
]

result = list(events_collection.aggregate(pipeline))

for user_data in result:
    print(f"–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á {user_data['_id']}: "
          f"{user_data['event_count']} –ø–æ–¥—ñ–π, "
          f"${user_data['total_spent']:.2f} –≤–∏—Ç—Ä–∞—á–µ–Ω–æ")
```

---

## 2.3 –Ü–Ω–¥–µ–∫—Å–∏ —Ç–∞ Motor (15 —Ö–≤–∏–ª–∏–Ω)

### –Ü–Ω–¥–µ–∫—Å–∏: –ß–æ–º—É —Ü–µ –≤–∞–∂–ª–∏–≤–æ?

```python
# ‚ùå –ë–µ–∑ —ñ–Ω–¥–µ–∫—Å—É (Scan):
# MongoDB –º—É—Å–∏—Ç—å –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –∫–æ–∂–µ–Ω –¥–æ–∫—É–º–µ–Ω—Ç —É –∫–æ–ª–µ–∫—Ü—ñ—ó
# 1 –º–ª–Ω –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤ = 1000ms –∑–∞–ø–∏—Ç

events_collection.find({"user_id": 123})  # –°–∫–∞–Ω—É—î 1 –º–ª–Ω –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤!

# ‚úÖ –ó —ñ–Ω–¥–µ–∫—Å–æ–º (Seek):
# MongoDB –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –ø—Ä—è–º–æ –¥–æ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤ –∑ user_id=123
# 1 –º–ª–Ω –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤ = 5ms –∑–∞–ø–∏—Ç!

events_collection.create_index([("user_id", 1)])

# –¢–µ–ø–µ—Ä —Ç–æ–π –∂–µ –∑–∞–ø–∏—Ç –±—É–≤–∞—î –≤ 200 —Ä–∞–∑—ñ–≤ —à–≤–∏–¥—à–∏–º!
```

### –í–∏–¥–∏ –Ü–Ω–¥–µ–∫—Å—ñ–≤

```python
# 1. Simple Index (–Ω–∞ –æ–¥–Ω–µ –ø–æ–ª–µ)
events_collection.create_index([("user_id", 1)])
events_collection.create_index([("event_type", 1)])

# 2. Compound Index (–Ω–∞ –∫—ñ–ª—å–∫–∞ –ø–æ–ª—ñ–≤)
# –î–ª—è –∑–∞–ø–∏—Ç—É: –∑–Ω–∞–π—Ç–∏ –ø–æ–∫—É–ø–∫–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑–∞ –¥–∞—Ç–æ—é
events_collection.create_index([("user_id", 1), ("timestamp", -1)])

# 3. Unique Index (–∑–∞–±–æ—Ä–æ–Ω—è—î –¥—É–±–ª—é–≤–∞–Ω–Ω—è)
users_collection.create_index([("email", 1)], unique=True)

# 4. Geospatial Index (–¥–ª—è –≥–µ–æ-–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç)
events_collection.create_index([("geo.coordinates", "2dsphere")])

# –ü–æ—Ç—ñ–º –º–æ–∂–Ω–∞ —Ä–æ–±–∏—Ç–∏ –≥–µ–æ-–∑–∞–ø–∏—Ç–∏:
nearby = events_collection.find({
    "geo.coordinates": {
        "$near": {
            "$geometry": {
                "type": "Point",
                "coordinates": [50.4501, 30.5234]  # –ö–∏—ó–≤
            },
            "$maxDistance": 5000  # –≤ –º–µ—Ç—Ä–∞—Ö (5km)
        }
    }
})
```

### Motor: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏–π MongoDB

```python
# ================================================
# Motor –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—ó —Ä–æ–±–æ—Ç–∏ (–Ω–∞ Python 3.7+)
# ================================================

import asyncio
from motor.motor_asyncio import AsyncIOMotorClient

async def get_user_events():
    """
    –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–µ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–æ–¥—ñ–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.

    –ü–µ—Ä–µ–≤–∞–≥–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏–∏:
    - –ö–æ–ª–∏ —á–µ–∫–∞—î–º–æ –Ω–∞ MongoDB (I/O), —ñ–Ω—à—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –ø—Ä–æ–¥–æ–≤–∂—É—é—Ç—å—Å—è
    - –û–¥–∏–Ω –ø—Ä–æ—Ü–µ—Å ‚Üí 1000 –ø–∞—Ä–∞–ª–µ–ª—å–Ω–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤
    """
    client = AsyncIOMotorClient("mongodb+srv://...")
    db = client["data_science_db"]
    events_collection = db["events"]

    # –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ —Å–æ–±—ã—Ç–∏—è
    events = await events_collection.find(
        {"user_id": 123}
    ).to_list(length=100)

    return events

# –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É —Ñ—É–Ω–∫—Ü—ñ—é
result = asyncio.run(get_user_events())
print(result)

# ‚ùå –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞ –≤–µ—Ä—Å—ñ—è (–ë–ª–æ–∫—É—é—á–∞):
# –ü—Ä–æ–≥—Ä–∞–º–∞ —á–µ–∫–∞—î –Ω–∞ MongoDB ‚Üí –ø–æ–¥–≤–æ—î–Ω–Ω—è —á–∞—Å—É –≤–∏–∫–æ–Ω–∞–Ω–Ω—è

# ‚úÖ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞ –≤–µ—Ä—Å—ñ—è (–ù–µ–±–ª–æ–∫—É—é—á–∞):
# –ü—Ä–æ–≥—Ä–∞–º–∞ —Ä–æ–∑–ø–æ—á–∏–Ω–∞—î –¥—Ä—É–≥–∏–π –∑–∞–ø–∏—Ç –ø–æ–∫–∏ —á–µ–∫–∞—î –Ω–∞ –ø–µ—Ä—à–∏–π
```

---

## 2.4 –í–∏–±—ñ—Ä Between Embedding vs References

```
–î–æ–∫—É–º–µ–Ω—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ #1: Embedding (–≥–Ω—ñ–∑–¥—è–≤–∞–Ω–∏–π –¥–æ–∫—É–º–µ–Ω—Ç)
{
  _id: ObjectId(...),
  username: "ivan",
  email: "ivan@example.com",
  subscriptions: [
    { plan: "pro", started: "2024-01-01", expires: "2025-01-01" },
    { plan: "plus", started: "2023-06-01", expires: "2024-06-01" }
  ]  // ‚Üê –í—Å—ñ –¥–∞–Ω—ñ –≤ –æ–¥–Ω–æ–º—É –¥–æ–∫—É–º–µ–Ω—Ç—ñ
}

–ü–µ—Ä–µ–≤–∞–≥–∏:
‚úì –û–¥–∏–Ω –∑–∞–ø–∏—Ç –æ—Ç—Ä–∏–º—É—î –≤—Å—ñ –¥–∞–Ω—ñ
‚úì Atomicity: –æ–Ω–æ–≤–ª–µ–Ω–Ω—è subscription –∞—Ç–æ–º–∞—Ä–Ω–æ –∑ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º
‚úó –Ø–∫ –º–∞—Å—à—Ç–∞–±—É–≤–∞—Ç–∏, —è–∫—â–æ subscriptions –∑–∞–π–º–∞—é—Ç—å 1GB?

–î–æ–∫—É–º–µ–Ω—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ #2: References (–ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —ñ–Ω—à–∏–π –¥–æ–∫—É–º–µ–Ω—Ç)
// users collection
{ _id: 123, username: "ivan", email: "ivan@example.com" }

// subscriptions collection
{ _id: 456, user_id: 123, plan: "pro", started: "2024-01-01" }

–ü–µ—Ä–µ–≤–∞–≥–∏:
‚úì –ì–Ω—É—á–∫—ñ—Å—Ç—å: –º–æ–∂–Ω–∞ –¥–æ–¥–∞–≤–∞—Ç–∏ subscriptions –æ–∫—Ä–µ–º–æ
‚úì –ú–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è: subscriptions —É –æ–∫—Ä–µ–º—ñ–π –∫–æ–ª–µ–∫—Ü—ñ—ó
‚úó –î–≤–∞ –∑–∞–ø–∏—Ç–∏ –∑–∞–º—ñ—Å—Ç—å –æ–¥–Ω–æ–≥–æ (JOIN)

–ü—Ä–∞–≤–∏–ª–æ:
‚îú‚îÄ Embedding —è–∫—â–æ:
‚îÇ  ‚îú‚îÄ –î–∞–Ω—ñ –∑–∞–≤–∂–¥–∏ —á–∏—Ç–∞—é—Ç—å—Å—è —Ä–∞–∑–æ–º
‚îÇ  ‚îú‚îÄ –õ–æ–≥—ñ–∫–∞ 1:1 –∞–±–æ 1:Few (–º–∞–ª–æ –¥–æ—á—ñ—Ä–Ω–∏—Ö)
‚îÇ  ‚îî‚îÄ –î–æ–∫—É–º–µ–Ω—Ç –º–∞–≤ < 16MB
‚îî‚îÄ References —è–∫—â–æ:
   ‚îú‚îÄ –î–æ—á—ñ—Ä–Ω—ñ –¥–∞–Ω—ñ –º–æ–∂—É—Ç—å –∑–º—ñ–Ω—é–≤–∞—Ç–∏—Å—å –Ω–µ–∑–∞–ª–µ–∂–Ω–æ
   ‚îú‚îÄ –û–¥–∏–Ω –¥–æ –±–∞–≥–∞—Ç—å–æ—Ö (1:Many) –∑ –≤–µ–ª–∏–∫–æ—é –∫—ñ–ª—å–∫—ñ—Å—Ç—é
   ‚îî‚îÄ –î–æ–∫—É–º–µ–Ω—Ç –≤–µ–ª–∏–∫–∏–π
```

---

# ‚ö° 3. CACHING STRATEGIES (20 —Ö–≤–∏–ª–∏–Ω)

## 3.1 @lru_cache: –ö–µ—à —É –ø–∞–º'—è—Ç—ñ (10 —Ö–≤–∏–ª–∏–Ω)

### –ü—Ä–æ–±–ª–µ–º–∞: N-—Ç–∞ —Å—Ç–µ–ø–µ–Ω–Ω—è —Å–∫–ª–∞–¥–Ω—ñ—Å—Ç—å

```python
# ================================================
# –ü—Ä–∏–∫–ª–∞–¥ 1: Fibonacci –ë–ï–ó –∫–µ—à—É–≤–∞–Ω–Ω—è
# ================================================

def fibonacci(n):
    """
    –û–±—á–∏—Å–ª—ñ—Ç—å n-–π –µ–ª–µ–º–µ–Ω—Ç –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ—Å—Ç—ñ –§—ñ–±–æ–Ω–∞—á—á—ñ.

    fib(n) = fib(n-1) + fib(n-2)

    –ü–†–û–ë–õ–ï–ú–ê:
    fib(5) = fib(4) + fib(3)
         = (fib(3) + fib(2)) + fib(3)  ‚Üê fib(3) –æ–±—á–∏—Å–ª—é—î—Ç—å—Å—è 2 —Ä–∞–∑–∏!
         = fib(3) + fib(3) + fib(2)

    –ö—ñ–ª—å–∫—ñ—Å—Ç—å –≤–∏–∫–ª–∏–∫—ñ–≤ –¥–ª—è fib(n) ‚âà 2^n
    fib(30) ‚Üí 2^30 = 1 –º–ª—Ä–¥ –≤–∏–∫–ª–∏–∫—ñ–≤! ‚Üí 200ms
    fib(35) ‚Üí 2^35 = 34 –º–ª—Ä–¥ –≤–∏–∫–ª–∏–∫—ñ–≤! ‚Üí Timeout ‚è±Ô∏è
    """
    if n <= 1:
        return n
    return fibonacci(n - 1) + fibonacci(n - 2)

# –í–∏–º—ñ—Ä —á–∞—Å—É
import time
start = time.time()
result = fibonacci(30)
end = time.time()
print(f"fib(30) = {result}, hour = {end - start:.2f}ms")  # ~179ms
```

### –†—ñ—à–µ–Ω–Ω—è: @lru_cache (Least Recently Used)

```python
from functools import lru_cache

@lru_cache(maxsize=128)
def fibonacci(n):
    """
    –¢–æ–π –∂–µ –∞–ª–≥–æ—Ä–∏—Ç–º, –∞–ª–µ –∑ –∫–µ—à—É–≤–∞–Ω–Ω—è–º.

    –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î:
    1. –ü–µ—Ä—à–∏–π –≤–∏–∫–ª–∏–∫ fibonacci(5):
       - –†–µ–∑—É–ª—å—Ç–∞—Ç –Ω–µ —É –∫–µ—à—ñ
       - –û–±—á–∏—Å–ª–∏—Ç–∏
       - –ó–±–µ—Ä–µ–≥—Ç–∏ —É –∫–µ—à—ñ: {5: 5}

    2. –î—Ä—É–≥–∏–π –≤–∏–∫–ª–∏–∫ fibonacci(5):
       - –†–µ–∑—É–ª—å—Ç–∞—Ç —É –∫–µ—à—ñ!
       - –ü–æ–≤–µ—Ä–Ω—É—Ç–∏ –∑ –∫–µ—à—É –∑–∞ O(1)
       - –ù–µ–º–∞—î –æ–±—á–∏—Å–ª–µ–Ω—å

    maxsize=128 –æ–∑–Ω–∞—á–∞—î: –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –æ—Å—Ç–∞–Ω–Ω—ñ 128 —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤.
    –ö–æ–ª–∏ 129-–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–æ–¥–∞—î—Ç—å—Å—è, –Ω–∞–π—Å—Ç–∞—Ä—ñ—à–∏–π –≤–∏–¥–∞–ª—è—î—Ç—å—Å—è (LRU).
    """
    if n <= 1:
        return n
    return fibonacci(n - 1) + fibonacci(n - 2)

# –í–∏–º—ñ—Ä —á–∞—Å—É
start = time.time()
result = fibonacci(30)
end = time.time()
print(f"fib(30) = {result}, time = {end - start:.4f}ms")  # ~0.02ms

# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–µ—à—É
print(fibonacci.cache_info())
# CacheInfo(hits=27, misses=31, maxsize=128, currsize=31)
# hits=27: 27 —Ä–∞–∑—ñ–≤ –ø–æ–≤–µ—Ä–Ω—É–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —ñ–∑ –∫–µ—à—É
# misses=31: 31 —Ä–∞–∑ –¥–æ–≤–µ–ª–æ—Å—å –æ–±—á–∏—Å–ª—é–≤–∞—Ç–∏

# –û—á–∏—Å—Ç–∏—Ç–∏ –∫–µ—à
fibonacci.cache_clear()
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç–∏

```
Fibonacci(30) –ë–ï–ó –∫–µ—à—É:   179ms    (1 –º–ª—Ä–¥ –æ–ø–µ—Ä–∞—Ü—ñ–π)
Fibonacci(30) –ó –∫–µ—à–µ–º:    0.02ms   (31 –æ–ø–µ—Ä–∞—Ü—ñ—è)
–ü—Ä–∏—Å–∫–æ—Ä–µ–Ω–Ω—è:             ‚âà 9,000x —Ä–∞–∑!

Fibonacci(35) –ë–ï–ó –∫–µ—à—É:   Timeout  (34 –º–ª—Ä–¥ –æ–ø–µ—Ä–∞—Ü—ñ–π)
Fibonacci(35) –ó –∫–µ—à–µ–º:    0.01ms   (36 –æ–ø–µ—Ä–∞—Ü—ñ–π)
–ü—Ä–∏—Å–∫–æ—Ä–µ–Ω–Ω—è:             ‚âà 11,000x —Ä–∞–∑!
```

### –ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ @lru_cache?

```python
‚úÖ –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π @lru_cache –∫–æ–ª–∏:
  - –§—É–Ω–∫—Ü—ñ—è pure (–±–µ–∑ –ø–æ–±—ñ—á–Ω–∏—Ö –µ—Ñ–µ–∫—Ç—ñ–≤)
  - –û–¥–Ω–∞–∫–æ–≤—ñ –≤—Ö–æ–¥–∏ –∑–∞–≤–∂–¥–∏ –¥–∞—é—Ç—å –æ–¥–Ω–∞–∫–æ–≤–∏–π –≤–∏—Ö—ñ–¥
  - –†–µ–∑—É–ª—å—Ç–∞—Ç –∑–º—ñ–Ω—é—î—Ç—å—Å—è —Ä—ñ–¥–∫–æ

‚ùå –ù–ï –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π –∫–æ–ª–∏:
  - –§—É–Ω–∫—Ü—ñ—è –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ —Å—Ç–∞–Ω—É (random, datetime, –≥–ª–æ–±–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ)
  - –ü–æ—Ç—Ä–µ–±–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –º—ñ–∂ –ø—Ä–æ—Ü–µ—Å–∞–º–∏ (Gunicorn –º–∞—î 4 worker'–∏)
  - –†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ —á–∞—Å—É (—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó, —Ü—ñ–Ω–∏)
```

---

## 3.2 Redis: –†–æ–∑–ø–æ–¥—ñ–ª–µ–Ω–∏–π –ö–µ—à (10 —Ö–≤–∏–ª–∏–Ω)

### –ü—Ä–æ–±–ª–µ–º–∞ –∑ @lru_cache

```python
# –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ Gunicorn –∑ 4 worker'–∏:
#
# Client Request
#     ‚Üì
# Load Balancer
#     ‚Üì
# ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
# ‚îÇ Worker 1  ‚îÇ Worker 2  ‚îÇ Worker 3  ‚îÇ Worker 4  ‚îÇ
# ‚îÇ LRU Cache ‚îÇ LRU Cache ‚îÇ LRU Cache ‚îÇ LRU Cache ‚îÇ
# ‚îÇ {fib: {}} ‚îÇ {fib: {}} ‚îÇ {fib: {}} ‚îÇ {fib: {}} ‚îÇ
# ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
#
# –ü–†–û–ë–õ–ï–ú–ê:
# –Ø–∫—â–æ –∑–∞–ø–∏—Ç —ñ–¥–µ –¥–æ Worker 1, —ñ–Ω—à—ñ worker'–∏ –Ω–µ –∑–Ω–∞—é—Ç—å –ø—Ä–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç!
# –ö–µ—à –¥—É–±–ª—é—î—Ç—å—Å—è 4 —Ä–∞–∑–∏ ‚Üí –º–∞—Ä–Ω–æ —Ç—Ä–∞—á–∏–º–æ –ø–∞–º'—è—Ç—å
```

### –†—ñ—à–µ–Ω–Ω—è: –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∏–π Redis

```python
# –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ –∑ Redis:
#
# Client Request
#     ‚Üì
# Load Balancer
#     ‚Üì
# ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
# ‚îÇ Worker 1  ‚îÇ Worker 2  ‚îÇ Worker 3  ‚îÇ Worker 4  ‚îÇ
# ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
#      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îò
#            ‚îÇ            ‚îÇ           ‚îÇ
#     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
#     ‚îÇ      Redis (Single Source of Truth)  ‚îÇ
#     ‚îÇ   {fib:30: 832040, fib:35: 9227465} ‚îÇ
#     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
#
# –ü–ï–†–ï–í–ê–ì–ê:
# –û–¥–∏–Ω –∫–µ—à –¥–ª—è –≤—Å—ñ—Ö worker'—ñ–≤
# –ë–µ–∑ –¥—É–±–ª—é–≤–∞–Ω–Ω—è –ø–∞–º'—è—Ç—ñ
# TTL –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –≤–∏–¥–∞–ª–µ–Ω–Ω—è —Å—Ç–∞—Ä–∏—Ö –¥–∞–Ω–∏—Ö
```

### –ö–æ–¥ –∑ Redis

```python
import redis
import json

# –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
redis_client = redis.Redis(host='localhost', port=6379, decode_responses=True)

# 1. –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —É Redis
def cache_fibonacci(n, result):
    key = f"fib:{n}"
    # –ó–±–µ—Ä–µ–≥—Ç–∏ –∑ TTL 3600 —Å–µ–∫—É–Ω–¥ (1 –≥–æ–¥–∏–Ω–∞)
    redis_client.setex(key, 3600, json.dumps(result))

# 2. –û—Ç—Ä–∏–º–∞–Ω–Ω—è –∑ Redis
def get_fibonacci(n):
    key = f"fib:{n}"
    result = redis_client.get(key)  # None —è–∫—â–æ –Ω–µ–º–∞—î
    if result:
        return json.loads(result)
    return None

# 3. –ö–æ—Ä–∏—Å—Ç—É–≤–∞–Ω–Ω—è
n = 30
cached = get_fibonacci(n)
if cached is None:
    result = fibonacci(n)  # –û–±—á–∏—Å–ª–∏—Ç–∏
    cache_fibonacci(n, result)  # –ó–±–µ—Ä–µ–≥—Ç–∏
else:
    result = cached  # –í–∑—è—Ç–∏ –∑ –∫–µ—à—É

print(f"fib({n}) = {result}")
```

### Redis TTL: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏–ª—É—á–µ–Ω–Ω—è

```python
# TTL (Time To Live) - —è–∫ –¥–æ–≤–≥–æ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –¥–∞–Ω—ñ

# –ü—Ä–∏–∫–ª–∞–¥: –ö–µ—à —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
# –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –º–∞—é—Ç—å –±—É—Ç–∏ —Å–≤—ñ–∂–∏–º–∏ (–Ω–µ —Å—Ç–∞—Ä–∏–º–∏ –∑–∞ 1 –¥–µ–Ω—å)

redis_client.setex(
    f"recommendations:user:123",
    86400,  # 24 –≥–æ–¥–∏–Ω–∏ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
    json.dumps(recommendations)
)

# –ß–µ—Ä–µ–∑ 24 –≥–æ–¥–∏–Ω–∏ Redis –ê–í–¢–û–ú–ê–¢–ò–ß–ù–û –≤–∏–¥–∞–ª–∏—Ç—å –∫–ª—é—á
# –ù–µ–º–∞—î –ø–æ—Ç—Ä–µ–±–∏ —É manual cleanup!

# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ TTL –∫–ª—é—á–∞
ttl = redis_client.ttl("recommendations:user:123")
print(f"–î–æ –≤–∏–¥–∞–ª–µ–Ω–Ω—è: {ttl} —Å–µ–∫—É–Ω–¥")
```

---

# üì® 4. RABBITMQ MESSAGING (40 —Ö–≤–∏–ª–∏–Ω)

## 4.1 –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞ –û–±—Ä–æ–±–∫–∞ (10 —Ö–≤–∏–ª–∏–Ω)

### –ü—Ä–æ–±–ª–µ–º–∞: –î–æ–≤–≥—ñ –û–ø–µ—Ä–∞—Ü—ñ—ó

```python
# ‚ùå –°–ò–ù–•–†–û–ù–ù–ê –û–ë–†–û–ë–ö–ê (–ë–ª–æ–∫—É—é—á–∏ API):
@app.post("/signup")
def signup(user_data):
    # 1. –ó–±–µ—Ä–µ–≥—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —É –ë–î (10ms)
    user = save_user(user_data)  # ‚úì

    # 2. –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –ø—Ä–∏–≤—ñ—Ç–∞–ª—å–Ω–∏–π email (5000ms) ‚Üê –î–û–í–ì–ê!
    send_welcome_email(user.email)  # ‚Üê –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á —á–µ–∫–∞—î 5 —Å–µ–∫—É–Ω–¥!

    # 3. –û–±—á–∏—Å–ª–∏—Ç–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó (10000ms) ‚Üê –©–ï –î–û–í–®–ê!
    generate_recommendations(user.id)  # ‚Üê –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á —á–µ–∫–∞—î 15 —Å–µ–∫—É–Ω–¥!

    return {"status": "created", "user_id": user.id}

# –ß–∞—Å –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ API: 10 + 5000 + 10000 = 15010ms = 15 —Å–µ–∫ ‚è±Ô∏è
# –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á —Å–∫–∞—Å—É—î –∑–∞–ø–∏—Ç, –≤–≤–∞–∂–∞—Ç–∏–º–µ —â–æ —Å–∞–π—Ç –≤–ø–∞–≤!
```

### –†—ñ—à–µ–Ω–Ω—è: RabbitMQ (–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞ —á–µ—Ä–≥–∞)

```python
# ‚úÖ –ê–°–ò–ù–•–†–û–ù–ù–ê –û–ë–†–û–ë–ö–ê (–ù–µ–±–ª–æ–∫—É—é—á–∏ API):

@app.post("/signup")
def signup(user_data):
    # 1. –ó–±–µ—Ä–µ–≥—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —É –ë–î (10ms)
    user = save_user(user_data)  # ‚úì

    # 2. –û–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏ –ø–æ–¥—ñ—é —É RabbitMQ (5ms) ‚Üê –ú–ò–¢–¢–Ñ–í–û!
    publish_event({
        "type": "user.created",
        "user_id": user.id,
        "email": user.email
    })

    # –ü–æ–≤–µ—Ä–Ω—É—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –ú–ò–¢–¢–Ñ–í–û!
    return {"status": "created", "user_id": user.id}

# –ß–∞—Å –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ API: 10 + 5 = 15ms ‚úì
# –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑–∞–¥–æ–≤–æ–ª–µ–Ω–∏–π!

# –ê –í–°–ï –Ü–ù–®–ï (email, —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó) –ü–†–ê–¶–Æ–Ñ –ù–ê –§–û–ù–Ü:
#
# RabbitMQ Queue
#   ‚Üì
# Consumer 1: –í—ñ–¥–ø—Ä–∞–≤–ª—è—î email (–Ω–∞ —Ñ–æ–Ω—ñ, –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)
# Consumer 2: –û–±—á–∏—Å–ª—é—î —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó (–Ω–∞ —Ñ–æ–Ω—ñ, –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)
```

### –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Client (User)         ‚îÇ
‚îÇ   POST /signup          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ   API Server    ‚îÇ
    ‚îÇ (Fast, 15ms)    ‚îÇ
    ‚îÇ                 ‚îÇ
    ‚îÇ 1. Save user    ‚îÇ ‚Üê –ú–∏—Ç—Ç—î–≤–æ
    ‚îÇ 2. Queue event  ‚îÇ ‚Üê –ú–∏—Ç—Ç—î–≤–æ
    ‚îÇ 3. Return 200   ‚îÇ ‚Üê –ì–û–¢–û–í–û!
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ   RabbitMQ Message Broker     ‚îÇ
    ‚îÇ  (Queue: user.created events) ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ                 ‚îÇ              ‚îÇ
    ‚ñº                 ‚ñº              ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Consumer‚îÇ    ‚îÇ Consumer 2 ‚îÇ  ‚îÇ Consumer 3   ‚îÇ
‚îÇ   1     ‚îÇ    ‚îÇ            ‚îÇ  ‚îÇ              ‚îÇ
‚îÇ         ‚îÇ    ‚îÇ (Background‚îÇ  ‚îÇ (Background, ‚îÇ
‚îÇ Sends   ‚îÇ    ‚îÇ Job)       ‚îÇ  ‚îÇ Not Critical)‚îÇ
‚îÇ Email   ‚îÇ    ‚îÇ            ‚îÇ  ‚îÇ              ‚îÇ
‚îÇ (5sec)  ‚îÇ    ‚îÇ Generates  ‚îÇ  ‚îÇ Updates      ‚îÇ
‚îÇ Can Fail‚îÇ    ‚îÇRecommend.  ‚îÇ  ‚îÇAnalytics     ‚îÇ
‚îÇ         ‚îÇ    ‚îÇ (10sec)    ‚îÇ  ‚îÇ (2sec)       ‚îÇ
‚îÇ If Error‚îÇ    ‚îÇ Can Fail   ‚îÇ  ‚îÇCan Fail      ‚îÇ
‚îÇ ‚Üí Retry ‚îÇ    ‚îÇ ‚Üí Retry    ‚îÇ  ‚îÇ              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## 4.2 Producer-Consumer Pattern (15 —Ö–≤–∏–ª–∏–Ω)

### Producer: –û–ø—É–±–ª—ñ–∫—É–≤–∞–Ω–Ω—è –ü–æ–¥—ñ–π

```python
# ================================================
# –§–∞–π–ª: 04_rabbitmq_messaging.py (–í–ò–í–Ü–î–ü–ê–ö)
# ================================================

import pika
import json
from dataclasses import dataclass
from datetime import datetime

# 1. –í–∏–∑–Ω–∞—á–∏—Ç–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
@dataclass
class UserDataMessage:
    """
    –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–±—ã—Ç–∏—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.

    –ê—Ç—Ä–∏–±—É—Ç–∏:
      id: –£–Ω—ñ–∫–∞–ª—å–Ω–∏–π —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä —Å–æ–±—ã—Ç–∏—è
      type: –¢–∏–ø —Å–æ–±—ã—Ç–∏—è ("user.created", "user.updated")
      payload: –ö–æ—Ä–∏—Å–Ω—ñ –¥–∞–Ω—ñ (username, email)
      timestamp: –ö–æ–ª–∏ —Å—Ç–∞–ª–∞—Å—è –ø–æ–¥—ñ—è
    """
    id: str
    type: str
    payload: dict
    timestamp: str

# 2. –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ RabbitMQ
connection = pika.BlockingConnection(
    pika.ConnectionParameters(host='localhost')
)
channel = connection.channel()

# 3. –û–≥–æ–ª–æ—à—É–≤–∞—Ç–∏ exchange (–º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä –ø–æ–¥—ñ–π)
# –¢–∞–∫–∏—Ö exchange'—ñ–≤ –º–æ–∂–µ –±—É—Ç–∏ –∫—ñ–ª—å–∫–∞
channel.exchange_declare(
    exchange='user_events',      # –Ü–º'—è
    exchange_type='topic',       # –¢–∏–ø: topic –¥–æ–∑–≤–æ–ª—è—î pattern matching
    durable=True                 # –ó–±–µ—Ä—ñ–≥–∞—Ç–∏—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
)

# 4. –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ–ø—É–±–ª—ñ–∫—É–≤–∞–Ω–Ω—è —Å–æ–±—ã—Ç–∏—è
def publish_user_event(username, email):
    """
    –û–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏ –ø–æ–¥—ñ—é —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.

    Args:
        username: –Ü–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
        email: Email –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
    """
    # –°—Ç–≤–æ—Ä–∏—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
    message = UserDataMessage(
        id=str(uuid.uuid4()),
        type="user.created",
        payload={"username": username, "email": email},
        timestamp=datetime.utcnow().isoformat()
    )

    # –û–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏
    channel.basic_publish(
        exchange='user_events',
        routing_key='user.created',  # –ö–ª—é—á –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü—ñ—ó
        body=json.dumps(message.__dict__),  # –°–µ—Ä—ñ–∞–ª—ñ–∑—É–≤–∞—Ç–∏
        properties=pika.BasicProperties(
            delivery_mode=pika.DeliveryMode.Persistent  # –ó–±–µ—Ä–µ–≥—Ç–∏ –Ω–∞ –¥–∏—Å–∫
        )
    )

    print(f"‚úì –û–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω–æ: {message.type}")

# 5. –í–∏–∫–ª–∏–∫–∞—Ç–∏ publisher
publish_user_event("ivan", "ivan@example.com")
```

### Consumer: –û–±—Ä–æ–±–∫–∞ –ü–æ–¥—ñ–π

```python
# ================================================
# Consumer: –°–ª—É—Ö–∞—î —Ç–∞ –æ–±—Ä–æ–±–ª—è—î —Å–æ–±—ã—Ç–∏—è
# ================================================

def callback(ch, method, properties, body):
    """
    Callback —Ñ—É–Ω–∫—Ü—ñ—è, —è–∫–∞ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –∫–æ–ª–∏ –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è.

    Args:
        ch: Channel
        method: –ú–µ—Ç–∞–¥–∞–Ω–Ω—ñ (delivery_tag)
        properties: –í–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
        body: –°–∞–º–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è (JSON string)
    """
    try:
        # 1. –î–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
        message_data = json.loads(body)
        print(f"‚úì –û—Ç—Ä–∏–º–∞–Ω–æ: {message_data['type']}")

        # 2. –û–±—Ä–æ–±–∏—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
        if message_data['type'] == 'user.created':
            username = message_data['payload']['username']
            email = message_data['payload']['email']

            # –ó–±–µ—Ä–µ–≥—Ç–∏ —É MongoDB
            users_collection.insert_one({
                "username": username,
                "email": email,
                "created_at": datetime.utcnow(),
                "segments": ["new_user"]
            })

            print(f"‚úì –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á {username} –∑–±–µ—Ä–µ–∂–µ–Ω–∏–π —É MongoDB")

        # 3. –ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –æ–±—Ä–æ–±–∫—É (ACK)
        ch.basic_ack(delivery_tag=method.delivery_tag)
        print(f"‚úì Mensaje procesado con √©xito")

    except Exception as e:
        # –Ø–∫—â–æ –ø–æ–º–∏–ª–∫–∞ ‚Üí NACK (–≤—ñ–¥—Ö–∏–ª–∏—Ç–∏)
        ch.basic_nack(delivery_tag=method.delivery_tag, requeue=True)
        print(f"‚úó –ü–æ–º–∏–ª–∫–∞: {e}, –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø–æ–≤–µ—Ä–Ω–µ–Ω–æ —É —á–µ—Ä–≥—É")

# –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ handler –¥–ª—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
channel.basic_qos(prefetch_count=1)  # –û–±—Ä–æ–±–ª—è—Ç–∏ –ø–æ –æ–¥–Ω–æ–º—É
channel.basic_consume(
    queue='user_data_queue',
    on_message_callback=callback,
    auto_ack=False  # –†—É—á–Ω–µ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è
)

print("üîÑ –ß–µ–∫–∞—î–º–æ –Ω–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è...")
channel.start_consuming()  # –ë–ª–æ–∫—É—é—á–∏–π —Ü–∏–∫–ª
```

---

## 4.3 Error Handling —Ç–∞ Retry Logic (15 —Ö–≤–∏–ª–∏–Ω)

### –ü—Ä–æ–±–ª–µ–º–∞: –í—ñ–¥–º–æ–≤–∞ –ü–æ—Å–ª—É–≥–∏

```python
# ‚ùå –ù–ê–á–í–ù–ê –û–ë–†–û–ë–ö–ê:

def callback(ch, method, properties, body):
    message_data = json.loads(body)

    # –°–ø—Ä–æ–±—É—î–º–æ –∑–±–µ—Ä–µ–≥—Ç–∏ —É MongoDB
    users_collection.insert_one(message_data)  # ‚Üê –ü–û–ú–ò–õ–ö–ê!
    # MongoDB –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ ‚Üí –í–∏–Ω—è—Ç–æ–∫, –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤—Ç—Ä–∞—á–µ–Ω–æ!

    ch.basic_ack(...)
```

### –†—ñ—à–µ–Ω–Ω—è: Retry Logic

```python
# ‚úÖ –†–û–ó–£–ú–ù–ê –û–ë–†–û–ë–ö–ê (–∑ –ø–æ–≤—Ç–æ—Ä–∞–º–∏):

def callback(ch, method, properties, body):
    message_data = json.loads(body)
    retry_count = properties.headers.get('x-retry-count', 0)

    try:
        # –°–ø—Ä–æ–±—É—î–º–æ –æ–±—Ä–æ–±–∏—Ç–∏
        users_collection.insert_one(message_data)
        ch.basic_ack(delivery_tag=method.delivery_tag)

    except Exception as e:
        # –ü–æ–º–∏–ª–∫–∞! –°–ø—Ä–æ–±—É—î–º–æ —â–µ —Ä–∞–∑
        if retry_count < 3:  # Max 3 —Å–ø—Ä–æ–±–∏
            # Exponential backoff: 2^retry_count —Å–µ–∫—É–Ω–¥
            delay = 2 ** retry_count  # 1, 2, 4 —Å–µ–∫

            # –ü–æ–≤–µ—Ä–Ω—É—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —É —á–µ—Ä–≥—É –∑ –∑–∞—Ç—Ä–∏–º–∫–æ—é
            ch.basic_nack(
                delivery_tag=method.delivery_tag,
                requeue=True
            )

            print(f"‚ö†Ô∏è –ü–æ–º–∏–ª–∫–∞, —Å–ø—Ä–æ–±–∞ {retry_count + 1}, —á–µ–∫–∞—î–º–æ {delay}s...")
            time.sleep(delay)

        else:
            # –í—Å—ñ —Å–ø—Ä–æ–±–∏ –≤–∏—á–µ—Ä–ø–∞–Ω—ñ ‚Üí –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ —É Dead Letter Queue
            channel.basic_publish(
                exchange='dlx',  # Dead Letter Exchange
                routing_key='user.failed',
                body=body
            )

            ch.basic_ack(...)  # –í–∏–∑–Ω–∞—Ç–∏ —Ä–µ—Ü–µ–ø—Ü—ñ—é (—â–æ–± –Ω–µ —Ü–∏–∫–ª—é–≤–∞—Ç–∏—Å—è)
            print(f"‚úó –ü–æ–º–∏–ª–∫–∞ –ø—ñ—Å–ª—è 3 —Å–ø—Ä–æ–±, –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ —É DLQ")
```

### Dead Letter Queue (DLQ)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Main Queue: user_data_queue                 ‚îÇ
‚îÇ ‚îú‚îÄ –£—Å–ø—ñ—Ö ‚Üí ACK ‚Üí –í–∏–¥–∞–ª–∏—Ç–∏ –∑ —á–µ—Ä–≥–∏           ‚îÇ
‚îÇ ‚îú‚îÄ –ü–æ–º–∏–ª–∫–∞ (retry_count < 3) ‚Üí NACK ‚Üí Retry ‚îÇ
‚îÇ ‚îî‚îÄ –ü–æ–º–∏–ª–∫–∞ (retry_count >= 3) ‚Üí DLX         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ
                     ‚ñº
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ Dead Letter Exchange (DLX)‚îÇ
         ‚îÇ Exchange: dlx             ‚îÇ
         ‚îÇ Routing key: user.failed  ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ
                     ‚ñº
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ Dead Letter Queue (DLQ)   ‚îÇ
         ‚îÇ Queue: user.dlq           ‚îÇ
         ‚îÇ –°—é–¥–∞ –ø–æ—Ç—Ä–∞–ø–ª—è—é—Ç—å –Ω–∞ —Å–æ–±—ã—Ç–∏—è‚îÇ
         ‚îÇ —è–∫—ñ –Ω–µ –≤–∏–π—à–ª–æ—Å—å –æ–±—Ä–æ–±–∏—Ç–∏  ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ
                     ‚ñº
         Developer —Ä–æ–∑–≥–ª—è–¥–∞—î DLQ,
         —Ä–æ–∑—ñ–±—Ä–∞—î—Ç—å—Å—è –∑ –ø—Ä–æ–±–ª–µ–º–æ—é,
         –≤—Ä—É—á–Ω—É –ø–æ–≤–µ—Ä—Ç–∞—î —É –æ—Å–Ω–æ–≤–Ω—É —á–µ—Ä–≥—É
```

---

# ü§ñ 5. REAL-WORLD INTEGRATION (20 —Ö–≤–∏–ª–∏–Ω)

## 5.1 –ü–æ–≤–Ω–∏–π Pipeline: User-Oriented Data Flow

### –°—Ü–µ–Ω–∞—Ä—ñ–π: –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø—ñ–¥–ø–∏—Å—É—î—Ç—å—Å—è

```
STEP 1: API Server
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ POST /api/users/signup                   ‚îÇ
‚îÇ Payload: { username, email }             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚îÇ
             ‚ñº
             ‚úì –ó–±–µ—Ä–µ–≥—Ç–∏ —É PostgreSQL (10ms)
             ‚úì –û–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏ –ø–æ–¥—ñ—é (5ms)
             ‚úì –ü–æ–≤–µ—Ä–Ω—É—Ç–∏ 200 OK (15ms)

STEP 2: RabbitMQ Queue
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Event: user.created                      ‚îÇ
‚îÇ { type, user_id, username, email }       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚îÇ
             ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
             ‚îÇ         ‚îÇ            ‚îÇ              ‚îÇ
             ‚ñº         ‚ñº            ‚ñº              ‚ñº

STEP 3: Consumers (Background Jobs)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Consumer1‚îÇ ‚îÇ Consumer2  ‚îÇ ‚îÇ Consumer3    ‚îÇ ‚îÇConsumer4 ‚îÇ
‚îÇ          ‚îÇ ‚îÇ            ‚îÇ ‚îÇ              ‚îÇ ‚îÇ          ‚îÇ
‚îÇ Mongo:   ‚îÇ ‚îÇ Redis:     ‚îÇ ‚îÇ Send Email:  ‚îÇ ‚îÇAnalytics:‚îÇ
‚îÇ Store    ‚îÇ ‚îÇ Create     ‚îÇ ‚îÇ Welcome msg  ‚îÇ ‚îÇ Log      ‚îÇ
‚îÇ event    ‚îÇ ‚îÇ user cache ‚îÇ ‚îÇ (5 sec)      ‚îÇ ‚îÇ event    ‚îÇ
‚îÇ log      ‚îÇ ‚îÇ            ‚îÇ ‚îÇ              ‚îÇ ‚îÇ          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ            ‚îÇ                ‚îÇ             ‚îÇ
     ‚ñº            ‚ñº                ‚ñº             ‚ñº

STEP 4: Data Storage
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ PostgreSQL   ‚îÇ ‚îÇ MongoDB   ‚îÇ ‚îÇ Redis Cache ‚îÇ
‚îÇ (Users)      ‚îÇ ‚îÇ (Events)  ‚îÇ ‚îÇ             ‚îÇ
‚îÇ user_id: 1   ‚îÇ ‚îÇ event_log ‚îÇ ‚îÇ user:1:profile
‚îÇ username:... ‚îÇ ‚îÇ events[]  ‚îÇ ‚îÇ {...}       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

STEP 5: Data Science Engine (Background Job)
     ‚îÇ
     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Calculate User Segment:                ‚îÇ
‚îÇ - New User ‚Üí "new_user" segment        ‚îÇ
‚îÇ - Calculate profile score ‚Üí 50         ‚îÇ
‚îÇ - Calculate churn risk ‚Üí 5%            ‚îÇ
‚îÇ - Predict LTV ‚Üí $500                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ Generate        ‚îÇ
    ‚îÇ Recommendations ‚îÇ
    ‚îÇ (top-10 items)  ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚îÇ
             ‚ñº
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ Cache in Redis (1 hour TTL)  ‚îÇ
    ‚îÇ recommendations:user:1 ‚Üí [...] ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

STEP 6: User Gets Results
     ‚îÇ
     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí GET /api/users/1/recommendations
             ‚Üì
             Check Redis Cache (1-5ms)
             ‚Üì
             Return recommendations

Performance:
  Signup response: 15ms ‚úì
  Background processing: Parallel, invisible to user
  User gets recommendations: 1-5ms (cached)
```

---

## 5.2 User Segmentation & Predictions

### –ú–æ–¥–µ–ª—å –°–µ–≥–º–µ–Ω—Ç–∞—Ü—ñ—ó

```python
# ================================================
# –§–∞–π–ª: 05_realworld_data_science.py (–í–ò–í–Ü–î–ü–ê–ö)
# ================================================

from enum import Enum
from datetime import datetime, timedelta

class UserSegment(Enum):
    """
    –°–µ–≥–º–µ–Ω—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –Ω–∞ –æ—Å–Ω–æ–≤—ñ —ó—Ö –ø–æ–≤–µ–¥—ñ–Ω–∫–∏.

    –ö–æ–∂–µ–Ω —Å–µ–≥–º–µ–Ω—Ç ‚Üí –°–≤–æ—è —Å—Ç—Ä–∞—Ç–µ–≥—ñ—è –≤–∑–∞—î–º–æ–¥—ñ—ó:
    """
    DORMANT = "dormant"      # üí§ –°–ø–ª—è—Ç—å (–Ω–µ –∞–∫—Ç–∏–≤–Ω—ñ 90+ –¥–Ω—ñ–≤)
    ACTIVE = "active"        # ‚≠ê –ê–∫—Ç–∏–≤–Ω—ñ (—Ä–µ–≥—É–ª—è—Ä–Ω—ñ –ø–æ–∫—É–ø–∫–∏)
    VIP = "vip"              # üëë VIP (–≤–∏—Å–æ–∫—ñ –≤–∏–¥–∞—Ç–∫–∏)
    AT_RISK = "at_risk"      # üö® –ù–∞ –º–µ–∂—ñ (–ø—Ä–∏–∑–Ω–∞–∫–∏ –≤—ñ–¥—Ç–æ–∫—É)

def calculate_user_segment(user_data):
    """
    –í–∏–∑–Ω–∞—á–∏—Ç–∏ —Å–µ–≥–º–µ–Ω—Ç –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–∞ –æ—Å–Ω–æ–≤—ñ –º–µ—Ç—Ä–∏–∫.

    Args:
        user_data: {
            "user_id": 123,
            "registration_date": datetime(2023-01-01),
            "purchases": [{"date": ..., "amount": ...}, ...],
            "last_login": datetime(2024-01-01)
        }

    Returns:
        UserSegment enum
    """
    # 1. –û–±—á–∏—Å–ª–∏—Ç–∏ –∫–ª—é—á–æ–≤—ñ –º–µ—Ç—Ä–∏–∫–∏
    days_since_last_purchase = (
        datetime.utcnow() - max(p['date'] for p in user_data['purchases'] if p['date'])
    ).days if user_data['purchases'] else 999

    days_since_registration = (
        datetime.utcnow() - user_data['registration_date']
    ).days

    total_spent = sum(p['amount'] for p in user_data['purchases'])

    # 2. –õ–æ–≥—ñ–∫–∞ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü—ñ—ó
    # –Ø–∫—â–æ –Ω–µ –∞–∫—Ç–∏–≤–Ω–∏–π > 90 –¥–Ω—ñ–≤ ‚Üí DORMANT
    if days_since_last_purchase > 90:
        return UserSegment.DORMANT

    # –Ø–∫—â–æ –≤–∏—Ç—Ä–∞—Ç–∏–≤ > $1000 ‚Üí VIP
    elif total_spent > 1000:
        return UserSegment.VIP

    # –Ø–∫—â–æ –≤–∏—Ç—Ä–∞—Ç–∏–≤ < $100 –∞–ª–µ –∞–∫—Ç–∏–≤–Ω–∏–π < 30 –¥–Ω—ñ–≤ ‚Üí AT_RISK
    elif total_spent < 100 and days_since_last_purchase < 30:
        return UserSegment.AT_RISK

    # –Ü–Ω—à—ñ ‚Üí ACTIVE
    else:
        return UserSegment.ACTIVE

# –ü—Ä–∏–∫–ª–∞–¥
user = {
    "user_id": 123,
    "registration_date": datetime(2023-06-01),
    "purchases": [
        {"date": datetime(2024-01-10), "amount": 50},
        {"date": datetime(2024-01-15), "amount": 150},
    ],
    "last_login": datetime(2024-01-15)
}

segment = calculate_user_segment(user)
print(f"–°–µ–≥–º–µ–Ω—Ç –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞: {segment.value}")  # "active"
```

### Churn Prediction (–ø–µ—Ä–µ–¥–±–∞—á–µ–Ω–Ω—è –≤—ñ–¥—Ç–æ–∫—É)

```python
import math

def predict_churn_probability(user_data):
    """
    –ü–µ—Ä–µ–¥–±–∞—á–∏—Ç–∏ –π–º–æ–≤—ñ—Ä–Ω—ñ—Å—Ç—å, —â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∫–∏–Ω–µ –ø—Ä–æ–¥—É–∫—Ç.

    –õ–æ–≥—ñ–∫–∞:
      - –°–≤—ñ–∂–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á (—â–æ–π–Ω–æ –≤–∏–≥–æ–ª–æ—à–µ–Ω–∞) ‚Üí –Ω–∏–∑—å–∫–∏–π —Ä–∏–∑–∏–∫
      - –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –±–µ–∑ –ø–æ–∫—É–ø–æ–∫ 30+ –¥–Ω—ñ–≤ ‚Üí –≤–∏—Å–æ–∫–∏–π —Ä–∏–∑–∏–∫
      - –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –±–µ–∑ –ø–æ–∫—É–ø–æ–∫ 60+ –¥–Ω—ñ–≤ ‚Üí –¥—É–∂–µ –≤–∏—Å–æ–∫–∏–π —Ä–∏–∑–∏–∫

    –§–æ—Ä–º—É–ª–∞: –õ–æ–≥—ñ—Å—Ç–∏—á–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è (S-–∫—Ä–∏–≤–∞)
      churn_prob = 1 / (1 + exp(-(x - 30) / 20))

    –î–µ x = –¥–Ω—ñ –≤—ñ–¥ –æ—Å—Ç–∞–Ω–Ω—å–æ—ó –ø–æ–∫—É–ø–∫–∏
    """
    days_since_purchase = (
        datetime.utcnow() - max(p['date'] for p in user_data['purchases'])
    ).days if user_data['purchases'] else 0

    # –õ–æ–≥—ñ—Å—Ç–∏—á–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è
    exponent = (days_since_purchase - 30) / 20
    churn_prob = 1 / (1 + math.exp(-exponent))

    return churn_prob * 100  # –£ –≤—ñ–¥—Å–æ—Ç–∫–∞—Ö

# –ü—Ä–∏–∫–ª–∞–¥–∏
users = [
    {"purchases": [{"date": datetime.utcnow() - timedelta(days=5)}]},   # –°–≤—ñ–∂–∞
    {"purchases": [{"date": datetime.utcnow() - timedelta(days=30)}]},  # –ù–∞ –º–µ–∂—ñ
    {"purchases": [{"date": datetime.utcnow() - timedelta(days=60)}]},  # –†–∏–∑–∏–∫
]

for user in users:
    churn = predict_churn_probability(user)
    print(f"–†–∏–∑–∏–∫ –≤—ñ–¥—Ç–æ–∫—É: {churn:.1f}%")

# –í–∏—Ö—ñ–¥:
# –†–∏–∑–∏–∫ –≤—ñ–¥—Ç–æ–∫—É: 27.0%  (5 –¥–Ω—ñ–≤ –≤—ñ–¥ –ø–æ–∫—É–ø–∫–∏ - –º–∞–ª–æ —Ä–∏–∑–∏–∫—É)
# –†–∏–∑–∏–∫ –≤—ñ–¥—Ç–æ–∫—É: 50.0%  (30 –¥–Ω—ñ–≤ - 50-50)
# –†–∏–∑–∏–∫ –≤—ñ–¥—Ç–æ–∫—É: 73.0%  (60 –¥–Ω—ñ–≤ - –≤–∏—Å–æ–∫–∏–π —Ä–∏–∑–∏–∫!)
```

### Lifetime Value (LTV) Prediction

```python
def predict_ltv(user_data):
    """
    –ü–µ—Ä–µ–¥–±–∞—á–∏—Ç–∏ –∑–∞–≥–∞–ª—å–Ω–∏–π –¥–æ—Ö—ñ–¥ –≤—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤–ø—Ä–æ–¥–æ–≤–∂ –π–æ–≥–æ "–∂–∏—Ç—Ç—è".

    –õ–æ–≥—ñ–∫–∞:
      LTV = (–°–µ—Ä–µ–¥–Ω—è –ø–æ–∫—É–ø–∫–∞) √ó (–ß–∞—Å—Ç–æ—Ç–∞ –ø–æ–∫—É–ø–æ–∫ –Ω–∞ –º—ñ—Å—è—Ü—å) √ó (–ú–µ—Å—è—Ü —É—Ç—Ä–∏–º–∞–Ω–Ω—è)

    –ü—Ä–∏–∫–ª–∞–¥:
      - –°–µ—Ä–µ–¥–Ω—è –ø–æ–∫—É–ø–∫–∞: $50
      - –ß–∞—Å—Ç–æ—Ç–∞: 2 –Ω–∞ –º—ñ—Å—è—Ü—å
      - –£—Ç—Ä–∏–º–∞—Ç–∏ 2 —Ä–æ–∫–∏ (24 –º—ñ—Å—è—Ü—ñ)
      - LTV = 50 √ó 2 √ó 24 = $2400
    """
    purchases = user_data['purchases']

    if not purchases:
        return 0.0

    # 1. –°—Ä–µ–¥–Ω—è—è –ø–æ–∫—É–ø–∫–∞
    avg_purchase = sum(p['amount'] for p in purchases) / len(purchases)

    # 2. –†–µ–≥—É–ª—è—Ä–Ω—ñ—Å—Ç—å (–ø–æ–∫—É–ø–∫–∏ –Ω–∞ –º—ñ—Å—è—Ü—å)
    registration_date = user_data['registration_date']
    days_active = (datetime.utcnow() - registration_date).days
    months_active = days_active / 30

    purchase_frequency = len(purchases) / months_active if months_active > 0 else 0

    # 3. –ü–µ—Ä–µ–¥–±–∞—á–∏—Ç–∏ —É—Ç—Ä–∏–º–∞–Ω–Ω—è (–º—ñ—Å—è—Ü—ñ–≤)
    # –Ø–∫—â–æ –ø–æ–∫—É–ø–ª—è—é—Ç—å —á–∞—Å—Ç–æ ‚Üí —É—Ç—Ä–∏–º–∞—î–º–æ –¥–æ–≤—à–µ
    retention_months = min(60, 12 + purchase_frequency * 10)

    # 4. –û–±—á–∏—Å–ª–∏—Ç–∏ LTV
    ltv = avg_purchase * purchase_frequency * retention_months

    return ltv

# –ü—Ä–∏–∫–ª–∞–¥
user = {
    "registration_date": datetime(2023-01-01),
    "purchases": [
        {"amount": 50}, {"amount": 75}, {"amount": 100}, {"amount": 125}
    ]
}

ltv = predict_ltv(user)
print(f"LTV (Lifetime Value): ${ltv:.2f}")
# –í–∏—Ö—ñ–¥: LTV (Lifetime Value): $2550.00
```

### Recommendation Strategy (–ø–æ —Å–µ–≥–º–µ–Ω—Ç–∞–º)

```python
def get_personalized_recommendations(user_id, segment):
    """
    –†—ñ–∑–Ω—ñ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö —Å–µ–≥–º–µ–Ω—Ç—ñ–≤.

    DORMANTUsers:
      - –ü–æ–∫–∞–∂–∏—Ç–µ –ß–¢–û-–ù–ò–ë–£–î–¨, —â–æ–± –≤–µ—Ä–Ω—É—Ç–∏
      - Flash sale, —Å–∫–∏–¥–∫–∏

    ACTIVE Users:
      - Personalized recommendations
      - –ù–∞ –æ—Å–Ω–æ–≤—ñ —ñ—Å—Ç–æ—Ä—ñ—ó

    VIP Users:
      - Premium items
      - Early access

    AT_RISK Users:
      - Retention offers
      - "–ú–∏ –≤–∞—Å —Ü—ñ–Ω–∏–º–æ" messges
    """

    if segment == UserSegment.DORMANT:
        # "–ú–∏ —Å—É–º—É—î–º–æ –∑–∞ –≤–∞–º–∏!" –ø—Ä–æ–º–æ—Ü—ñ—è
        return {
            "strategy": "reactivation",
            "offer": "30% discount",
            "subject": "We miss you! Special offer inside"
        }

    elif segment == UserSegment.VIP:
        # Premium, exclusive items
        return {
            "strategy": "premium",
            "offer": "Early access to new products",
            "subject": "Exclusive VIP Preview - Just for You"
        }

    elif segment == UserSegment.AT_RISK:
        # Retention
        return {
            "strategy": "retention",
            "offer": "Free shipping on next order",
            "subject": "We value you - here's a special thank you"
        }

    else:  # ACTIVE
        # Personalized
        return {
            "strategy": "personalization",
            "offer": "Recommended items based on your tastes",
            "subject": "New items you'll love"
        }

# –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è
for segment in [UserSegment.DORMANT, UserSegment.VIP, UserSegment.AT_RISK]:
    recs = get_personalized_recommendations(123, segment)
    print(f"{segment.value}: {recs['offer']}")
```

---

# üéì 6. –í–ò–°–ù–û–í–ö–ò –Ü –î–û–ú–ê–®–ù–Ø –†–û–ë–û–¢–ê (15 —Ö–≤–∏–ª–∏–Ω)

## –©–æ –º–∏ –≤–∏–≤—á–∏–ª–∏

| –¢–µ–º–∞ | –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è | –ö–ª—é—á–æ–≤–∏–π –ö–æ–Ω—Ü–µ–ø—Ç |
|------|--------------|------------------|
| **SQLAlchemy** | –°—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ | Relationships, eager loading |
| **MongoDB** | –ì–Ω—É—á–∫—ñ –¥–∞–Ω—ñ | Aggregation pipelines |
| **Caching** | –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å | LRU + Redis + TTL |
| **RabbitMQ** | –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å | Producer/Consumer, DLQ, Retries |
| **Data Science** | –ë—ñ–∑–Ω–µ—Å-—Ü—ñ–Ω–Ω—ñ—Å—Ç—å | Segmentation, predictions |

## –î–æ–º–∞—à–Ω—è –†–æ–±–æ—Ç–∞

### –ó–∞–≤–¥–∞–Ω–Ω—è 1: –î–æ–¥–∞—Ç–∏ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü—ñ—é –≤ MongoDB
```python
# –û–Ω–æ–≤–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ –π–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–æ–º
db.users.update_one(
    {"_id": user_id},
    {"$set": {
        "segment": "active",
        "ltv_prediction": 2500,
        "churn_risk": 0.15
    }}
)
```

### –ó–∞–≤–¥–∞–Ω–Ω—è 2: –î–æ–¥–∞—Ç–∏ Redis –∫–µ—à –∑ —ñ–Ω–≤–∞–ª—ñ–¥–∞—Ü—ñ—î—é
```python
# –ö–µ—à—É–≤–∞—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø–∏—Ç—É –∑–∞ 1 –≥–æ–¥–∏–Ω—É
redis.setex(f"users:country:{country}", 3600, json.dumps(users))

# –Ü–Ω–≤–∞–ª—ñ–¥—É–≤–∞—Ç–∏ –∫–æ–ª–∏ –Ω–æ–≤–∞ –ø–æ–¥—ñ—è
consumer.on_user_created ‚Üí redis.delete(f"users:country:{new_user.country}")
```

### –ó–∞–≤–¥–∞–Ω–Ω—è 3: –ù–∞–ø–∏—Å–∞—Ç–∏ —Ç–µ—Å—Ç —ñ–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—ñ
```python
# –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ —Ç—É –∂ –ø–æ–¥—ñ—é –¥–≤—ñ—á—ñ
producer.publish("user.created", event_data)
producer.publish("user.created", event_data)  # –û–¥–Ω–∞–∫–æ–≤–∞ –ø–æ–¥—ñ—è

# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ —É –ë–î —Ç—ñ–ª—å–∫–∏ –æ–¥–∏–Ω –∑–∞–ø–∏—Å
assert db.users.count_documents({"email": "test@example.com"}) == 1
```

---

## üìö –ö–ª—é—á–æ–≤—ñ –§–∞–π–ª–∏ –¥–ª—è –í–∏–≤—á–µ–Ω–Ω—è

1. **01_sqlalchemy_advanced.py** ‚Üí ORM (70 —Ö–≤)
2. **02_mongodb_advanced.py** ‚Üí NoSQL (50 —Ö–≤)
3. **03_caching_strategies.py** ‚Üí Performance (20 —Ö–≤)
4. **04_rabbitmq_messaging.py** ‚Üí Async (40 —Ö–≤)
5. **05_realworld_data_science.py** ‚Üí Integration (20 —Ö–≤)

## üîó –†–µ—Å—É—Ä—Å–∏

- **SQLAlchemy 2.0**: https://docs.sqlalchemy.org/en/20/
- **MongoDB Manual**: https://docs.mongodb.com/manual/
- **Redis**: https://redis.io/docs/
- **RabbitMQ**: https://www.rabbitmq.com/getstarted.html

---

**–ó–∞–Ω—è—Ç—Ç—è –ó–∞–≤–µ—Ä—à–µ–Ω–æ!** ‚úÖ
