<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Contacts App</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f0f2f5; }
    .card { border: none; box-shadow: 0 2px 12px rgba(0,0,0,.08); }
    .birthday-badge { font-size: .75rem; }
    #contactsTable td { vertical-align: middle; }
    .spinner-border { width: 1.2rem; height: 1.2rem; }
  </style>
</head>
<body>

<!-- ĞĞ°Ğ²Ğ±Ğ°Ñ€ -->
<nav class="navbar navbar-dark bg-primary px-4 mb-4">
  <span class="navbar-brand fw-bold">ğŸ“‹ Contacts App</span>
  <div class="d-flex align-items-center gap-3">
    <span class="text-white small" id="userEmail"></span>
    <button class="btn btn-outline-light btn-sm" id="logoutBtn">Ğ’Ğ¸Ğ¹Ñ‚Ğ¸</button>
  </div>
</nav>

<div class="container">
  <div class="row g-4">

    <!-- â”€â”€â”€ Ğ›Ñ–Ğ²Ğ° ĞºĞ¾Ğ»Ğ¾Ğ½ĞºĞ°: ÑĞ¿Ğ¸ÑĞ¾Ğº ĞºĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ñ–Ğ² â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="col-lg-8">

      <!-- ĞŸĞ¾ÑˆÑƒĞº + ĞºĞ½Ğ¾Ğ¿ĞºĞ° Ğ´Ğ¾Ğ´Ğ°Ñ‚Ğ¸ -->
      <div class="d-flex gap-2 mb-3">
        <input type="text" id="searchInput" class="form-control"
               placeholder="ĞŸĞ¾ÑˆÑƒĞº Ğ·Ğ° Ñ–Ğ¼ĞµĞ½ĞµĞ¼ Ğ°Ğ±Ğ¾ emailâ€¦">
        <button class="btn btn-primary text-nowrap" data-bs-toggle="modal"
                data-bs-target="#addModal">+ Ğ”Ğ¾Ğ´Ğ°Ñ‚Ğ¸</button>
      </div>

      <!-- Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ -->
      <div class="card">
        <div class="card-body p-0">
          <table class="table table-hover mb-0" id="contactsTable">
            <thead class="table-light">
              <tr>
                <th>Ğ†Ğ¼'Ñ</th>
                <th>Email</th>
                <th>Ğ¢ĞµĞ»ĞµÑ„Ğ¾Ğ½</th>
                <th>Ğ”Ğ°Ñ‚Ğ° Ğ½Ğ°Ñ€Ğ¾Ğ´Ğ¶ĞµĞ½Ğ½Ñ</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="contactsTbody">
              <tr><td colspan="5" class="text-center text-muted py-4">
                <span class="spinner-border me-2"></span>Ğ—Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ½Ñâ€¦
              </td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- ĞŸĞ°Ğ³Ñ–Ğ½Ğ°Ñ†Ñ–Ñ (Ğ¿Ñ€Ğ¾ÑÑ‚Ğ°) -->
      <div class="d-flex justify-content-between align-items-center mt-2 text-muted small" id="paginationBar">
        <span id="pageInfo"></span>
        <div class="d-flex gap-2">
          <button class="btn btn-sm btn-outline-secondary" id="prevBtn" disabled>â† ĞŸĞ¾Ğ¿ĞµÑ€ĞµĞ´Ğ½Ñ</button>
          <button class="btn btn-sm btn-outline-secondary" id="nextBtn" disabled>ĞĞ°ÑÑ‚ÑƒĞ¿Ğ½Ğ° â†’</button>
        </div>
      </div>
    </div>

    <!-- â”€â”€â”€ ĞŸÑ€Ğ°Ğ²Ğ° ĞºĞ¾Ğ»Ğ¾Ğ½ĞºĞ°: birthdays + Ğ¿Ñ€Ğ¾Ñ„Ñ–Ğ»ÑŒ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="col-lg-4">

      <!-- Birthdays -->
      <div class="card mb-3">
        <div class="card-header fw-semibold">ğŸ‚ Ğ”Ğ½Ñ– Ğ½Ğ°Ñ€Ğ¾Ğ´Ğ¶ĞµĞ½Ğ½Ñ (7 Ğ´Ğ½Ñ–Ğ²)</div>
        <div class="card-body p-0">
          <ul class="list-group list-group-flush" id="birthdayList">
            <li class="list-group-item text-muted text-center small">Ğ—Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ½Ñâ€¦</li>
          </ul>
        </div>
      </div>

      <!-- ĞŸÑ€Ğ¾Ñ„Ñ–Ğ»ÑŒ -->
      <div class="card">
        <div class="card-header fw-semibold">ğŸ‘¤ ĞŸÑ€Ğ¾Ñ„Ñ–Ğ»ÑŒ</div>
        <div class="card-body text-center">
          <img id="avatarImg" src="https://ui-avatars.com/api/?name=U&size=80&rounded=true"
               class="rounded-circle mb-2" width="80" alt="avatar">
          <p class="mb-1 small text-muted" id="profileEmail">â€”</p>
          <label class="btn btn-sm btn-outline-secondary mt-1">
            Ğ—Ğ¼Ñ–Ğ½Ğ¸Ñ‚Ğ¸ Ñ„Ğ¾Ñ‚Ğ¾
            <input type="file" id="avatarInput" accept="image/*" hidden>
          </label>
          <div id="avatarMsg" class="small mt-1"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- â”€â”€â”€ ĞœĞ¾Ğ´Ğ°Ğ»ÑŒĞ½Ğµ Ğ²Ñ–ĞºĞ½Ğ¾: Ğ´Ğ¾Ğ´Ğ°Ñ‚Ğ¸ ĞºĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="modal fade" id="addModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalTitle">ĞĞ¾Ğ²Ğ¸Ğ¹ ĞºĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="editId">
        <div class="mb-2">
          <label class="form-label">Ğ†Ğ¼'Ñ *</label>
          <input type="text" id="fFirstName" class="form-control" placeholder="Ğ†Ğ²Ğ°Ğ½" required>
        </div>
        <div class="mb-2">
          <label class="form-label">ĞŸÑ€Ñ–Ğ·Ğ²Ğ¸Ñ‰Ğµ *</label>
          <input type="text" id="fLastName" class="form-control" placeholder="Ğ¤Ñ€Ğ°Ğ½ĞºĞ¾" required>
        </div>
        <div class="mb-2">
          <label class="form-label">Email</label>
          <input type="email" id="fEmail" class="form-control" placeholder="ivan@example.com">
        </div>
        <div class="mb-2">
          <label class="form-label">Ğ¢ĞµĞ»ĞµÑ„Ğ¾Ğ½</label>
          <input type="text" id="fPhone" class="form-control" placeholder="+380501234567">
        </div>
        <div class="mb-2">
          <label class="form-label">Ğ”Ğ°Ñ‚Ğ° Ğ½Ğ°Ñ€Ğ¾Ğ´Ğ¶ĞµĞ½Ğ½Ñ</label>
          <input type="date" id="fBirthday" class="form-control">
        </div>
        <div id="formError" class="text-danger small d-none"></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ğ¡ĞºĞ°ÑÑƒĞ²Ğ°Ñ‚Ğ¸</button>
        <button type="button" class="btn btn-primary" id="saveBtn">Ğ—Ğ±ĞµÑ€ĞµĞ³Ñ‚Ğ¸</button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
  // â”€â”€â”€ ĞĞ°Ğ»Ğ°ÑˆÑ‚ÑƒĞ²Ğ°Ğ½Ğ½Ñ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const BASE = "";
  const PAGE_SIZE = 20;
  let skip = 0;
  let searchQuery = "";
  let searchTimer = null;

  // â”€â”€â”€ ĞĞ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ñ–Ñ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const token = localStorage.getItem("access_token");
  if (!token) window.location.href = "/app/login.html";

  const headers = { Authorization: `Bearer ${token}` };

  // â”€â”€â”€ Ğ£Ñ‚Ğ¸Ğ»Ñ–Ñ‚Ğ°: API Ğ·Ğ°Ğ¿Ğ¸Ñ‚ Ğ· Ğ°Ğ²Ñ‚Ğ¾-Ñ€ĞµĞ´Ñ–Ñ€ĞµĞºÑ‚Ğ¾Ğ¼ Ğ¿Ñ€Ğ¸ 401 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function apiFetch(path, opts = {}) {
    const r = await fetch(BASE + path, {
      ...opts,
      headers: { ...headers, ...(opts.headers || {}) },
    });
    if (r.status === 401) {
      localStorage.clear();
      window.location.href = "/app/login.html";
    }
    return r;
  }

  // â”€â”€â”€ ĞŸÑ€Ğ¾Ñ„Ñ–Ğ»ÑŒ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function loadProfile() {
    const r = await apiFetch("/api/v1/users/me");
    if (!r.ok) return;
    const user = await r.json();
    document.getElementById("userEmail").textContent = user.email;
    document.getElementById("profileEmail").textContent = user.email;
    if (user.avatar_url) {
      document.getElementById("avatarImg").src = user.avatar_url;
    }
  }

  // â”€â”€â”€ Birthdays â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function loadBirthdays() {
    const r = await apiFetch("/api/v1/contacts/birthdays");
    const list = document.getElementById("birthdayList");

    if (!r.ok) {
      list.innerHTML = '<li class="list-group-item text-danger small">ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ° Ğ·Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ½Ñ</li>';
      return;
    }

    const data = await r.json();
    if (data.length === 0) {
      list.innerHTML = '<li class="list-group-item text-muted text-center small">ĞĞµĞ¼Ğ°Ñ” Ğ½Ğ°Ğ¹Ğ±Ğ»Ğ¸Ğ¶Ñ‡Ğ¸Ñ…</li>';
      return;
    }

    list.innerHTML = data.map(b => `
      <li class="list-group-item d-flex justify-content-between align-items-center">
        <span>${b.first_name} ${b.last_name}</span>
        <span class="badge bg-warning text-dark birthday-badge">${b.birthday}</span>
      </li>
    `).join("");
  }

  // â”€â”€â”€ Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº ĞºĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ñ–Ğ² â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function loadContacts() {
    const tbody = document.getElementById("contactsTbody");
    tbody.innerHTML = '<tr><td colspan="5" class="text-center text-muted py-3">' +
      '<span class="spinner-border me-2"></span>Ğ—Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ½Ñâ€¦</td></tr>';

    const params = new URLSearchParams({ skip, limit: PAGE_SIZE });
    if (searchQuery) params.set("search", searchQuery);

    const r = await apiFetch(`/api/v1/contacts/?${params}`);
    if (!r.ok) {
      tbody.innerHTML = '<tr><td colspan="5" class="text-danger text-center">ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ°</td></tr>';
      return;
    }

    const contacts = await r.json();

    document.getElementById("pageInfo").textContent =
      `ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ğ½Ğ¾: ${skip + 1}â€“${skip + contacts.length}`;
    document.getElementById("prevBtn").disabled = skip === 0;
    document.getElementById("nextBtn").disabled = contacts.length < PAGE_SIZE;

    if (contacts.length === 0) {
      tbody.innerHTML = '<tr><td colspan="5" class="text-center text-muted py-4">ĞšĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ğ¸ Ğ½Ğµ Ğ·Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ–</td></tr>';
      return;
    }

    tbody.innerHTML = contacts.map(c => `
      <tr>
        <td>${c.first_name} ${c.last_name}</td>
        <td>${c.email || "â€”"}</td>
        <td>${c.phone || "â€”"}</td>
        <td>${c.birthday || "â€”"}</td>
        <td class="text-end">
          <button class="btn btn-sm btn-outline-secondary me-1"
                  onclick="openEdit(${JSON.stringify(c).replace(/"/g, '&quot;')})">âœï¸</button>
          <button class="btn btn-sm btn-outline-danger"
                  onclick="deleteContact(${c.id})">ğŸ—‘</button>
        </td>
      </tr>
    `).join("");
  }

  // â”€â”€â”€ ĞŸĞ¾ÑˆÑƒĞº Ğ· debounce â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  document.getElementById("searchInput").addEventListener("input", (e) => {
    clearTimeout(searchTimer);
    searchTimer = setTimeout(() => {
      searchQuery = e.target.value.trim();
      skip = 0;
      loadContacts();
    }, 300);
  });

  // â”€â”€â”€ ĞŸĞ°Ğ³Ñ–Ğ½Ğ°Ñ†Ñ–Ñ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  document.getElementById("prevBtn").addEventListener("click", () => {
    skip = Math.max(0, skip - PAGE_SIZE);
    loadContacts();
  });
  document.getElementById("nextBtn").addEventListener("click", () => {
    skip += PAGE_SIZE;
    loadContacts();
  });

  // â”€â”€â”€ Ğ¤Ğ¾Ñ€Ğ¼Ğ°: Ğ²Ñ–Ğ´ĞºÑ€Ğ¸Ñ‚Ğ¸ Ğ´Ğ»Ñ Ñ€ĞµĞ´Ğ°Ğ³ÑƒĞ²Ğ°Ğ½Ğ½Ñ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function openEdit(contact) {
    document.getElementById("modalTitle").textContent = "Ğ ĞµĞ´Ğ°Ğ³ÑƒĞ²Ğ°Ñ‚Ğ¸ ĞºĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚";
    document.getElementById("editId").value = contact.id;
    document.getElementById("fFirstName").value = contact.first_name;
    document.getElementById("fLastName").value = contact.last_name;
    document.getElementById("fEmail").value = contact.email || "";
    document.getElementById("fPhone").value = contact.phone || "";
    document.getElementById("fBirthday").value = contact.birthday || "";
    new bootstrap.Modal(document.getElementById("addModal")).show();
  }

  // â”€â”€â”€ Ğ¤Ğ¾Ñ€Ğ¼Ğ°: Ğ¾Ñ‡Ğ¸ÑÑ‚Ğ¸Ñ‚Ğ¸ Ğ¿Ñ€Ğ¸ Ğ²Ñ–Ğ´ĞºÑ€Ğ¸Ñ‚Ñ‚Ñ– "Ğ”Ğ¾Ğ´Ğ°Ñ‚Ğ¸" â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  document.getElementById("addModal").addEventListener("show.bs.modal", (e) => {
    if (!e.relatedTarget) return;  // Ğ²Ñ–Ğ´ĞºÑ€Ğ¸Ñ‚Ğ¾ Ñ‡ĞµÑ€ĞµĞ· openEdit â€” Ğ½Ğµ Ğ¾Ñ‡Ğ¸Ñ‰Ğ°Ñ‚Ğ¸
    document.getElementById("modalTitle").textContent = "ĞĞ¾Ğ²Ğ¸Ğ¹ ĞºĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚";
    document.getElementById("editId").value = "";
    ["fFirstName","fLastName","fEmail","fPhone","fBirthday"].forEach(id => {
      document.getElementById(id).value = "";
    });
    document.getElementById("formError").classList.add("d-none");
  });

  // â”€â”€â”€ Ğ—Ğ±ĞµÑ€ĞµĞ³Ñ‚Ğ¸ ĞºĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚ (create Ğ°Ğ±Ğ¾ update) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  document.getElementById("saveBtn").addEventListener("click", async () => {
    const id = document.getElementById("editId").value;
    const payload = {
      first_name: document.getElementById("fFirstName").value.trim(),
      last_name: document.getElementById("fLastName").value.trim(),
      email: document.getElementById("fEmail").value.trim() || null,
      phone: document.getElementById("fPhone").value.trim() || null,
      birthday: document.getElementById("fBirthday").value || null,
    };

    const errEl = document.getElementById("formError");
    if (!payload.first_name || !payload.last_name) {
      errEl.textContent = "Ğ†Ğ¼'Ñ Ñ‚Ğ° Ğ¿Ñ€Ñ–Ğ·Ğ²Ğ¸Ñ‰Ğµ Ğ¾Ğ±Ğ¾Ğ²'ÑĞ·ĞºĞ¾Ğ²Ñ–.";
      errEl.classList.remove("d-none");
      return;
    }
    errEl.classList.add("d-none");

    const url = id ? `/api/v1/contacts/${id}` : "/api/v1/contacts/";
    const method = id ? "PATCH" : "POST";

    const r = await apiFetch(url, {
      method,
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload),
    });

    if (r.ok) {
      bootstrap.Modal.getInstance(document.getElementById("addModal")).hide();
      loadContacts();
      loadBirthdays();
    } else {
      const data = await r.json();
      errEl.textContent = data.detail || "ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ° Ğ·Ğ±ĞµÑ€ĞµĞ¶ĞµĞ½Ğ½Ñ.";
      errEl.classList.remove("d-none");
    }
  });

  // â”€â”€â”€ Ğ’Ğ¸Ğ´Ğ°Ğ»Ğ¸Ñ‚Ğ¸ ĞºĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function deleteContact(id) {
    if (!confirm("Ğ’Ğ¸Ğ´Ğ°Ğ»Ğ¸Ñ‚Ğ¸ ĞºĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚?")) return;
    const r = await apiFetch(`/api/v1/contacts/${id}`, { method: "DELETE" });
    if (r.status === 204) {
      loadContacts();
      loadBirthdays();
    }
  }

  // â”€â”€â”€ ĞĞ²Ğ°Ñ‚Ğ°Ñ€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  document.getElementById("avatarInput").addEventListener("change", async (e) => {
    const file = e.target.files[0];
    if (!file) return;

    const msgEl = document.getElementById("avatarMsg");
    msgEl.textContent = "Ğ—Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ÑƒÑâ€¦";

    const formData = new FormData();
    formData.append("file", file);

    const r = await apiFetch("/api/v1/users/me/avatar", {
      method: "POST",
      body: formData,
      // Content-Type: multipart/form-data â€” Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€ Ğ²ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ÑÑ” Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡Ğ½Ğ¾
    });

    if (r.ok) {
      const user = await r.json();
      document.getElementById("avatarImg").src = user.avatar_url + `?t=${Date.now()}`;
      msgEl.textContent = "âœ… ĞĞ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¾";
    } else {
      const data = await r.json();
      msgEl.textContent = `âŒ ${data.detail || "ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ°"}`;
    }
  });

  // â”€â”€â”€ Logout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  document.getElementById("logoutBtn").addEventListener("click", async () => {
    const rt = localStorage.getItem("refresh_token");
    if (rt) {
      // Ğ—Ğ°Ğ½ĞµÑÑ‚Ğ¸ refresh token Ñƒ Redis blacklist
      await apiFetch("/api/v1/auth/logout", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ refresh_token: rt }),
      }).catch(() => {});
    }
    localStorage.clear();
    window.location.href = "/app/login.html";
  });

  // â”€â”€â”€ Ğ†Ğ½Ñ–Ñ†Ñ–Ğ°Ğ»Ñ–Ğ·Ğ°Ñ†Ñ–Ñ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  loadProfile();
  loadContacts();
  loadBirthdays();
</script>
</body>
</html>
