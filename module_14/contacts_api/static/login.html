<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Contacts App ‚Äî Login</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f0f2f5; }
    .card { border: none; box-shadow: 0 2px 12px rgba(0,0,0,.08); }
  </style>
</head>
<body class="d-flex align-items-center justify-content-center min-vh-100">

<div class="card p-4" style="width: 380px;">
  <h4 class="mb-4 text-center">üìã Contacts App</h4>

  <!-- –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è -->
  <div id="alert" class="alert d-none" role="alert"></div>

  <!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥—É -->
  <form id="loginForm">
    <div class="mb-3">
      <label class="form-label">Email</label>
      <input type="email" id="email" class="form-control" placeholder="demo@example.com" required>
    </div>
    <div class="mb-3">
      <label class="form-label">–ü–∞—Ä–æ–ª—å</label>
      <input type="password" id="password" class="form-control" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
    </div>
    <button type="submit" class="btn btn-primary w-100" id="submitBtn">–£–≤—ñ–π—Ç–∏</button>
  </form>

  <hr class="my-3">

  <!-- –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è (–≤–±—É–¥–æ–≤–∞–Ω–∞) -->
  <details>
    <summary class="text-muted small" style="cursor:pointer">–ù–µ–º–∞—î –∞–∫–∞—É–Ω—Ç—É? –ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—å</summary>
    <form id="registerForm" class="mt-3">
      <div class="mb-2">
        <input type="email" id="regEmail" class="form-control form-control-sm" placeholder="Email" required>
      </div>
      <div class="mb-2">
        <input type="password" id="regPassword" class="form-control form-control-sm" placeholder="–ü–∞—Ä–æ–ª—å (–º—ñ–Ω. 8 —Å–∏–º–≤–æ–ª—ñ–≤)" required>
      </div>
      <button type="submit" class="btn btn-outline-secondary btn-sm w-100">–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—å</button>
    </form>
  </details>

  <!-- –ü—ñ–¥–∫–∞–∑–∫–∞ –¥–ª—è —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∞ -->
  <div class="mt-3 p-2 bg-light rounded small text-muted">
    <strong>MailHog:</strong>
    <a href="http://localhost:8025" target="_blank">localhost:8025</a>
    ‚Äî –ø–µ—Ä–µ–≤—ñ—Ä –ª–∏—Å—Ç –¥–ª—è –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
  </div>
</div>

<script>
  const BASE = "";  // —Ç–æ–π —Å–∞–º–∏–π origin ‚Äî FastAPI —Å–µ—Ä–≤–µ—Ä–∏—Ç—å —ñ UI, —ñ API

  // ‚îÄ‚îÄ‚îÄ –£—Ç–∏–ª—ñ—Ç–∞: –ø–æ–∫–∞–∑–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function showAlert(msg, type = "danger") {
    const el = document.getElementById("alert");
    el.className = `alert alert-${type}`;
    el.textContent = msg;
    el.classList.remove("d-none");
  }

  function hideAlert() {
    document.getElementById("alert").classList.add("d-none");
  }

  // ‚îÄ‚îÄ‚îÄ –Ø–∫—â–æ –≤–∂–µ –∑–∞–ª–æ–≥—ñ–Ω–µ–Ω–∏–π ‚Äî –ø–µ—Ä–µ–∫–∏–Ω—É—Ç–∏ –Ω–∞ contacts ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  if (localStorage.getItem("access_token")) {
    window.location.href = "/app/contacts.html";
  }

  // ‚îÄ‚îÄ‚îÄ Login ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  document.getElementById("loginForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    hideAlert();

    const btn = document.getElementById("submitBtn");
    btn.disabled = true;
    btn.textContent = "–í—Ö–æ–¥–∂—É...";

    // Login –≤–∏–º–∞–≥–∞—î form-data (OAuth2PasswordRequestForm), –∞ –Ω–µ JSON
    const body = new URLSearchParams({
      username: document.getElementById("email").value,
      password: document.getElementById("password").value,
    });

    try {
      const r = await fetch(`${BASE}/api/v1/auth/login`, {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body,
      });

      const data = await r.json();

      if (r.ok) {
        // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —Ç–æ–∫–µ–Ω–∏ —É localStorage
        localStorage.setItem("access_token", data.access_token);
        localStorage.setItem("refresh_token", data.refresh_token);
        window.location.href = "/app/contacts.html";
      } else if (r.status === 403) {
        showAlert("üìß Email –Ω–µ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–∏–π. –ü–µ—Ä–µ–≤—ñ—Ä MailHog (localhost:8025).");
      } else {
        showAlert(data.detail || "–ù–µ–≤—ñ—Ä–Ω–∏–π email –∞–±–æ –ø–∞—Ä–æ–ª—å.");
      }
    } catch {
      showAlert("–ù–µ –≤–¥–∞–ª–æ—Å—è –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—å –¥–æ API. –ß–∏ –∑–∞–ø—É—â–µ–Ω–∏–π docker-compose?");
    } finally {
      btn.disabled = false;
      btn.textContent = "–£–≤—ñ–π—Ç–∏";
    }
  });

  // ‚îÄ‚îÄ‚îÄ Register ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  document.getElementById("registerForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    hideAlert();

    const email = document.getElementById("regEmail").value;
    const password = document.getElementById("regPassword").value;

    try {
      const r = await fetch(`${BASE}/api/v1/auth/register`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email, password }),
      });

      const data = await r.json();

      if (r.status === 201) {
        showAlert(
          `‚úÖ –ê–∫–∞—É–Ω—Ç —Å—Ç–≤–æ—Ä–µ–Ω–æ! –ü–µ—Ä–µ–≤—ñ—Ä MailHog (localhost:8025) —Ç–∞ –ø—ñ–¥—Ç–≤–µ—Ä–¥—å email.`,
          "success"
        );
        document.getElementById("regEmail").value = "";
        document.getElementById("regPassword").value = "";
      } else if (r.status === 409) {
        showAlert("–ê–∫–∞—É–Ω—Ç –∑ —Ç–∞–∫–∏–º email –≤–∂–µ —ñ—Å–Ω—É—î.");
      } else {
        showAlert(data.detail || "–ü–æ–º–∏–ª–∫–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó.");
      }
    } catch {
      showAlert("–ù–µ –≤–¥–∞–ª–æ—Å—è –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—å –¥–æ API.");
    }
  });
</script>
</body>
</html>
